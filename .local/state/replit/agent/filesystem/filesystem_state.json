{"file_contents":{"pages/_app.tsx":{"content":"import '../styles/globals.css'\nimport type { AppProps } from 'next/app'\n\nfunction MyApp({ Component, pageProps }: AppProps) {\n  return <Component {...pageProps} />\n}\n\nexport default MyApp\n","size_bytes":188},"next.config.ts":{"content":"import type { NextConfig } from \"next\";\n\nconst nextConfig: NextConfig = {\n  serverExternalPackages: [\"xlsx\"],\n  webpack: (config) => {\n    config.externals.push(\"xlsx\");\n    return config;\n  },\n};\n\nexport default nextConfig;\n","size_bytes":225},"pages/api/hello.ts":{"content":"// Next.js API route support: https://nextjs.org/docs/api-routes/introduction\nimport type { NextApiRequest, NextApiResponse } from 'next'\n\ntype Data = {\n  name: string\n}\n\nexport default function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<Data>\n) {\n  res.status(200).json({ name: 'John Doe' })\n}\n","size_bytes":307},"styles/globals.css":{"content":"html,\nbody {\n  padding: 0;\n  margin: 0;\n  font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen,\n    Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;\n}\n\na {\n  color: inherit;\n  text-decoration: none;\n}\n\n* {\n  box-sizing: border-box;\n}\n","size_bytes":275},"README.md":{"content":"# ğŸ¯ Cehpoint Client Insight Engine (CCIE)\n\nTransform your LinkedIn prospect data into actionable sales intelligence with AI-powered analysis.\n\n![Next.js](https://img.shields.io/badge/Next.js-15-black)\n![React](https://img.shields.io/badge/React-19-blue)\n![TypeScript](https://img.shields.io/badge/TypeScript-5-blue)\n![Gemini AI](https://img.shields.io/badge/Gemini-AI-purple)\n\n## âœ¨ Features\n\n- ğŸ¤– **AI-Powered Analysis**: Google Gemini API generates personalized insights\n- ğŸ”„ **Smart Key Rotation**: Automatic API key switching to bypass rate limits\n- ğŸ“Š **Multi-Format Support**: Upload Excel (.xlsx, .xls) or CSV files\n- ğŸ¯ **Client Categorization**: Identifies ideal prospects by role and needs\n- ğŸ’¬ **Conversation Starters**: Ready-to-send personalized messages\n- ğŸ“¥ **Export Options**: Download insights as TXT or JSON\n- ğŸŒ™ **Dark Mode**: Automatic theme switching\n- âš¡ **Serverless**: Optimized for Vercel deployment\n\n## ğŸš€ Quick Start\n\n### 1. Get API Keys\n\nVisit [Google AI Studio](https://ai.google.dev) and generate 2 free API keys.\n\n### 2. Deploy to Vercel\n\n[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new)\n\nAdd environment variables during deployment:\n- `GEMINI_API_KEY`\n- `GEMINI_API_KEY_2`\n\n### 3. Upload Your Data\n\nPrepare a CSV or Excel file with these columns:\n- `name` (required)\n- `role` or `occupation` (required)\n- `company` (required)\n- `location` (optional)\n- `description` (optional)\n\n## ğŸ“– How It Works\n\n1. **Upload**: Drop your prospect data file\n2. **Analyze**: AI processes each prospect in ~60 seconds\n3. **Get Insights**: View categorized prospects with:\n   - Profile analysis\n   - 3 tailored pitch suggestions\n   - Personalized conversation starters\n4. **Download**: Export as TXT or JSON\n\n## ğŸ› ï¸ Local Development\n\n```bash\n# Install dependencies\nnpm install\n\n# Set up environment variables\n# Add GEMINI_API_KEY and GEMINI_API_KEY_2\n\n# Run development server\nnpm run dev\n\n# Open http://localhost:5000\n```\n\n## ğŸ“ Example Input\n\n```csv\nname,role,company,location,description\nDeepak Kumar,Co-founder & CTO,Hood,Mumbai,Building consumer tech platform\nSougam Maity,Founder,Punyaha Health,Kolkata,Health-tech with HIPAA focus\n```\n\n## ğŸ“¤ Example Output\n\n```\n1. Deepak Kumar\n   Role: Co-founder & CTO @Hood\n\n   Profile Notes:\n   Building consumer-facing tech with scaling needs. Requires performance\n   optimization and rapid development cycles.\n\n   Pitch Suggestions:\n   1. Security review + vulnerability assessment\n   2. Dedicated feature development pod\n   3. Backend architecture optimization\n\n   Conversation Starter:\n   \"Deepak, I reviewed your role at Hood and noticed how quickly you're\n   scaling. We support tech-led teams with secure development...\"\n```\n\n## ğŸ”‘ API Key Rotation\n\nThe app automatically rotates between multiple API keys to:\n- Bypass free tier rate limits (1,500 requests/day per key)\n- Ensure zero downtime\n- Distribute load across keys\n\nAdd more keys by creating `GEMINI_API_KEY_3`, `GEMINI_API_KEY_4`, etc.\n\n## ğŸ—ï¸ Tech Stack\n\n- **Framework**: Next.js 15 (App Router)\n- **Language**: TypeScript 5\n- **Styling**: TailwindCSS 4\n- **AI**: Google Gemini 2.5-flash\n- **File Processing**: XLSX library\n- **Deployment**: Vercel (serverless)\n\n## ğŸ“š Documentation\n\n- [Developer Documentation](./DEVELOPER_DOCUMENTATION.md) - Complete technical guide\n- [Architecture](./DEVELOPER_DOCUMENTATION.md#architecture) - System design details\n- [API Reference](./DEVELOPER_DOCUMENTATION.md#api-reference) - Server actions and types\n\n## ğŸ”’ Security\n\n- API keys stored server-side only\n- File validation (type, size)\n- Input sanitization\n- No data persistence (stateless)\n\n## ğŸ¤ Contributing\n\nThis is an internal Cehpoint tool. For feature requests or bugs, contact the development team.\n\n## ğŸ“„ License\n\nProprietary - Cehpoint Internal Use Only\n\n## ğŸ†˜ Support\n\n- **Documentation**: See [DEVELOPER_DOCUMENTATION.md](./DEVELOPER_DOCUMENTATION.md)\n- **Issues**: Contact dev@cehpoint.com\n\n---\n\n**Built with â¤ï¸ by Cehpoint Development Team**\n","size_bytes":4047},"styles/Home.module.css":{"content":".container {\n  padding: 0 2rem;\n}\n\n.main {\n  min-height: 100vh;\n  padding: 4rem 0;\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n}\n\n.footer {\n  display: flex;\n  flex: 1;\n  padding: 2rem 0;\n  border-top: 1px solid #eaeaea;\n  justify-content: center;\n  align-items: center;\n}\n\n.footer a {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-grow: 1;\n}\n\n.title a {\n  color: #0070f3;\n  text-decoration: none;\n}\n\n.title a:hover,\n.title a:focus,\n.title a:active {\n  text-decoration: underline;\n}\n\n.title {\n  margin: 0;\n  line-height: 1.15;\n  font-size: 4rem;\n}\n\n.title,\n.description {\n  text-align: center;\n}\n\n.description {\n  margin: 4rem 0;\n  line-height: 1.5;\n  font-size: 1.5rem;\n}\n\n.code {\n  background: #fafafa;\n  border-radius: 5px;\n  padding: 0.75rem;\n  font-size: 1.1rem;\n  font-family: Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono,\n    Bitstream Vera Sans Mono, Courier New, monospace;\n}\n\n.grid {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n  max-width: 800px;\n}\n\n.card {\n  margin: 1rem;\n  padding: 1.5rem;\n  text-align: left;\n  color: inherit;\n  text-decoration: none;\n  border: 1px solid #eaeaea;\n  border-radius: 10px;\n  transition: color 0.15s ease, border-color 0.15s ease;\n  max-width: 300px;\n}\n\n.card:hover,\n.card:focus,\n.card:active {\n  color: #0070f3;\n  border-color: #0070f3;\n}\n\n.card h2 {\n  margin: 0 0 1rem 0;\n  font-size: 1.5rem;\n}\n\n.card p {\n  margin: 0;\n  font-size: 1.25rem;\n  line-height: 1.5;\n}\n\n.logo {\n  height: 1em;\n  margin-left: 0.2rem;\n}\n\n@media (max-width: 600px) {\n  .grid {\n    width: 100%;\n    flex-direction: column;\n  }\n}\n","size_bytes":1698},"pages/index.tsx":{"content":"import type { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport Image from \"next/image\";\nimport styles from \"../styles/Home.module.css\";\n\nconst Home: NextPage = () => {\n  return (\n    <div className={styles.container}>\n      <Head>\n        <title>Create Next App</title>\n        <meta name=\"description\" content=\"Generated by create next app\" />\n        <link rel=\"icon\" href=\"/favicon.ico\" />\n      </Head>\n\n      <main className={styles.main}>\n        <h1 className={styles.title}>Welcome to Next.js on Replit!</h1>\n\n        <p className={styles.description}>\n          Get started by editing{\" \"}\n          <code className={styles.code}>pages/index.tsx</code>\n        </p>\n\n        <div className={styles.grid}>\n          <a href=\"https://nextjs.org/docs\" className={styles.card}>\n            <h2>Documentation &rarr;</h2>\n            <p>Find in-depth information about Next.js features and API.</p>\n          </a>\n\n          <a href=\"https://nextjs.org/learn\" className={styles.card}>\n            <h2>Learn &rarr;</h2>\n            <p>Learn about Next.js in an interactive course with quizzes!</p>\n          </a>\n\n          <a\n            href=\"https://github.com/vercel/next.js/tree/canary/examples\"\n            className={styles.card}\n          >\n            <h2>Examples &rarr;</h2>\n            <p>Discover and deploy boilerplate example Next.js projects.</p>\n          </a>\n\n          <a\n            href=\"https://docs.replit.com/category/deployments\"\n            className={styles.card}\n          >\n            <h2>Deploy &rarr;</h2>\n            <p>After you are happy with this app, deploy it on Replit!</p>\n          </a>\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default Home;\n","size_bytes":1713},"next-env.d.ts":{"content":"/// <reference types=\"next\" />\n/// <reference types=\"next/image-types/global\" />\n\n// NOTE: This file should not be edited\n// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.\n","size_bytes":211},"app/layout.tsx":{"content":"import { Inter } from \"next/font/google\";\nimport type { Metadata } from \"next\";\nimport \"./globals.css\";\n\nconst inter = Inter({ subsets: [\"latin\"], weight: [\"400\", \"500\", \"600\", \"700\"] });\n\nexport const metadata: Metadata = {\n  title: \"Cehpoint Client Insight Engine | AI-Powered B2B Sales Intelligence\",\n  description: \"Transform your LinkedIn prospect data into actionable insights with AI-powered analysis. Generate personalized pitch suggestions and conversation starters for B2B outreach.\",\n  keywords: [\"B2B sales\", \"client insights\", \"AI analysis\", \"prospect intelligence\", \"sales enablement\"],\n  icons: {\n    icon: \"/favicon.svg\",\n  },\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"en\" suppressHydrationWarning>\n\n      <body className={`${inter.className} antialiased min-h-screen bg-white text-slate-950`} suppressHydrationWarning>\n        {children}\n      </body>\n    </html>\n  );\n}\n","size_bytes":975},"replit.md":{"content":"# Cehpoint Client Insight Engine\n\n## Overview\n\nThe Cehpoint Client Insight Engine is a premium, production-ready B2B sales enablement platform designed for marketing and sales teams. It transforms raw LinkedIn prospect data from Excel/CSV files into personalized, actionable outreach strategies. The platform generates client categorization, three tailored pitch suggestions per prospect, and conversation starters optimized for B2B sales conversations. Features include real-time batch processing, progressive streaming results, time-based pagination (15 prospects initially, then 15 every minute), mid-process export, and comprehensive data export options.\n\n## Key Updates (Current Session - v5.2)\n- âœ… **NEW: Production-Grade Error Handling** - Comprehensive error classification, retry logic, and multi-API-key fallback\n- âœ… **Multi-Key Rotation** - Automatic failover between PRIMARY, SECONDARY, and EXTRA Gemini API keys\n- âœ… **Intelligent Retry System** - Exponential backoff (1s â†’ 60s max) with 5 max attempts\n- âœ… **Error Classification** - RateLimitError, AuthError, ValidationError, TransientAPIError, FatalAPIError\n- âœ… **Key Cooldown Management** - Failed keys enter cooldown period, preventing cascading failures\n- âœ… **Enhanced Error Messages** - User-friendly error messages with actionable guidance\n- âœ… **Expand Pitch Feature** - Generate full detailed pitches (200-250 words) for each pitch suggestion\n- âœ… **Professional Modal UI** - Enterprise-grade popup with loading, error handling, and copy functionality\n- âœ… **Pitch Regeneration** - Regenerate all pitches for individual prospects with complete data preservation\n\n## Latest Improvements (v5.2 - Production-Grade Error Handling + Reliability)\n\n### NEW: Comprehensive Error Handling Infrastructure (v5.2)\n- âœ… **Error Classification System** (lib/errors.ts):\n  - RateLimitError: API rate limit exceeded (includes retryAfter metadata)\n  - AuthError: API authentication failed (triggers key rotation)\n  - ValidationError: Request/response validation errors\n  - TransientAPIError: Temporary failures (500, 502, 503, 504, timeouts)\n  - FatalAPIError: Non-retryable errors (400, malformed requests)\n  \n- âœ… **Retry Utilities** (lib/retry.ts):\n  - Exponential backoff: 1s â†’ 2s â†’ 4s â†’ 8s â†’ 16s (max 60s)\n  - Configurable jitter to prevent thundering herd\n  - Maximum 5 retry attempts per request\n  - Custom delay support for rate limit headers\n  \n- âœ… **GeminiClient with Multi-Key Rotation** (lib/gemini-client.ts):\n  - Primary key failover: GEMINI_API_KEY_PRIMARY â†’ GEMINI_API_KEY_SECONDARY\n  - Support for up to 5 extra keys: GEMINI_API_KEY_EXTRA_1 through GEMINI_API_KEY_EXTRA_5\n  - Intelligent key cooldown: Failed keys enter 60s (auth errors: 5min) cooldown\n  - Automatic key rotation on auth failures\n  - Per-key failure tracking and recovery\n  - Retry telemetry callback for monitoring\n  \n- âœ… **Enhanced API Routes**:\n  - All routes (analyze, expand-pitch, regenerate-pitch) now use GeminiClient\n  - Comprehensive error responses with HTTP status codes\n  - Rate limit responses include retryAfter header\n  - Graceful degradation for transient errors\n  \n- âœ… **Production-Ready Reliability**:\n  - Complete file processing regardless of size\n  - Automatic retry on rate limits with exponential backoff\n  - Multi-key fallback prevents single point of failure\n  - Clear error messages guide users on resolution\n\n### Pitch Expansion & Regeneration (v5.1)\n- âœ… **Expand Pitch Modal**: Click \"Expand\" on any pitch suggestion to generate a full 200-250 word detailed pitch\n- âœ… **Automatic Generation**: Modal automatically generates expanded pitch using Gemini AI on open\n- âœ… **Professional UI**: Loading skeleton, error handling with retry, copy-to-clipboard functionality\n- âœ… **Accessibility**: Escape key dismissal, backdrop click, body scroll prevention\n- âœ… **Context Preservation**: Uses complete prospect data (name, role, company, location, description)\n- âœ… **Regenerate Feature**: Regenerate all 3 pitch suggestions for individual prospects\n- âœ… **Data Integrity**: JSON escaping for special characters, Zod validation, proper error handling\n\n### Enterprise Design & Pagination (v4.0)\n\n### Landing Page Redesign - Enterprise Grade\n- âœ… **Split Hero Layout**: Left text/CTA, right gradient visual with geometric pattern\n- âœ… **KPI Metric Cards**: Redesigned with icons, proper badges, and soft shadows\n- âœ… **Feature Cards**: 3-column Stripe/Linear-style cards with hover effects\n- âœ… **Horizontal Timeline**: 3-step workflow with connecting line (not vertical)\n- âœ… **Dark CTA Section**: Navy gradient background with mesh texture\n- âœ… **Professional Footer**: 3-column structure with proper typography\n\n### Advanced Pagination System\n- âœ… **Time-Based Loading**: Load 15 prospects initially, wait 1 minute, load 15 more\n- âœ… **Mid-Process Export**: Download available insights while processing continues\n- âœ… **Continuous Processing**: Support unlimited prospects through automatic batching\n- âœ… **Progress Tracking**: Real-time progress percentage and prospect count display\n- âœ… **Flexible Export**: Export as Text or JSON at any point during processing\n\n### Enhanced Gemini Prompt\n- âœ… **Ideal Client Framework**: 4 buyer personas (Founders, CTOs, IT Service CEOs, Infrastructure Specialists)\n- âœ… **Business-Outcome Focused**: Pitches target business outcomes (speed, security, capacity, reliability)\n- âœ… **Personalized Conversation Starters**: Show understanding of specific role/company context\n- âœ… **Specialized Prompting**: Emphasis on prospect-specific insights without generic advice\n- âœ… **Framework-Based Analysis**: Categorize and group prospects by ideal client type\n\n### Design System - Complete Implementation\n- âœ… **Color Palette**: Deep Sapphire (#0C1A3D), Royal Blue (#2D65FF), Azure (#7BA7FF)\n- âœ… **Typography**: Inter font with proper hierarchy (56px H1, 36px H2, 24px H3, 17px body)\n- âœ… **Spacing Scale**: 8px-based (0, 8, 16, 24, 32, 48, 64, 80, 120)\n- âœ… **Shadows**: Soft (0 4px 16px rgba(0,0,0,0.06)) and Medium (0 8px 24px rgba(0,0,0,0.12))\n- âœ… **Rounded Corners**: 20px standard, consistent across all components\n\n## User Preferences\n\n**Communication Style**: Simple, everyday language without technical jargon.\n**Design Philosophy**: Enterprise-grade polish with meticulous attention to detailâ€”every element must be perfect, accurate, and display with professional decorum. Comparable to Stripe, Linear, Notion, HubSpot.\n**Theme**: Modern light theme with deep sapphire accents, clean whitespace, and premium typography.\n**Feature Priority**: Support unlimited prospect files with time-based pagination and mid-process export.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework**: Next.js 15 with React 19 and TypeScript using the App Router.\n**Pages**:\n- `/` (Homepage): Split hero layout, feature cards, horizontal timeline, CTA section, footer\n- `/upload`: File upload form, real-time progress tracking, streaming results display, export options\n\n**Design System**: Enterprise-grade light theme with:\n- Split hero layout (left: text/CTA, right: visual)\n- Soft shadows and 20px rounded corners\n- 8px-based spacing scale\n- Premium Inter typography with proper hierarchy\n- Sophisticated color palette with accent colors\n\n**Styling**: Tailwind CSS v4.0 with custom color system and spacing scales.\n**Animations**: Framer Motion for smooth micro-interactions with stagger effects.\n\n### Backend Architecture\n\n**Server-Side Processing**: Streaming API route (`/api/analyze`) for progressive batch analysis.\n**Pagination Strategy**:\n  - Load 15 prospects immediately in batches of 5\n  - Process remaining prospects in batches of 15 every 1 minute\n  - Each batch split into sub-batches of 5 for streaming\n  - Send export-ready report after each batch group\n\n**Streaming Pipeline**:\n  - Initial batch: 15 prospects in 5-prospect sub-batches\n  - Subsequent batches: 15 prospects every 60 seconds\n  - Real-time progress updates (totalProcessed/totalInFile)\n  - Mid-process export reports available at each checkpoint\n\n**File Processing**: `xlsx` library for Excel/CSV with flexible column mapping.\n**Data Validation**: Zod schema validation for input and output.\n\n### AI Integration\n\n**Service**: Google Gemini 2.5 Flash via custom GeminiClient wrapper.\n**Intelligence**: \n  - Ideal Client Framework with 4 buyer personas\n  - Generates category classification and prospect-level insights\n  - Three tailored pitch suggestions per prospect (business-outcome focused)\n  - Personalized conversation starters\n\n**Prompt Structure**:\n  - System: Expert B2B sales strategist context, ideal client framework, quality standards\n  - User: Prospect data batch with CRITICAL REQUIREMENTS and output format\n  - Output: Strict JSON with idealClientFramework + prospectInsights\n\n**API Key Management**: \n  - Multi-key rotation: PRIMARY â†’ SECONDARY â†’ EXTRA_1-5\n  - Automatic failover on auth errors\n  - Per-key cooldown and failure tracking\n  - Environment variables: GEMINI_API_KEY_PRIMARY, GEMINI_API_KEY_SECONDARY, GEMINI_API_KEY_EXTRA_1 through GEMINI_API_KEY_EXTRA_5\n\n## Design Standards\n\n### Hero Section\n- Split layout: Left (text/CTA, 50%), Right (gradient visual, 50%)\n- Headline: 56px, bold, leading 1.1\n- Subtext: 20px (1.25rem), max-width 600px\n- CTA buttons: Primary (Dark Navy) + Secondary (Outline)\n- Right visual: Gradient background with geometric SVG pattern\n\n### KPI Cards\n- White background, 20px rounded corners\n- Soft shadow: 0 4px 16px rgba(0, 0, 0, 0.06)\n- Icon: 16x16 inside circular badge (light blue background)\n- Number: 32px bold\n- Label: 14px medium\n- 3-column grid with equal spacing\n\n### Feature Cards\n- 3-column grid layout\n- White background, 20px rounded corners\n- Circular icon badge (48px) with light blue background\n- Title: 20px semibold\n- Description: max 2 lines, 15px regular\n- Hover shadow: 0 8px 24px rgba(0, 0, 0, 0.12)\n- Hover y-transform: -4px\n\n### Timeline Section\n- Horizontal 3-step layout\n- Connecting line between steps (subtle gradient)\n- Circular badges: 56px, Deep Sapphire background, white text\n- Step titles: 18px semibold\n- Step descriptions: max 2 lines\n- 64px spacing between steps\n\n### Dark CTA Section\n- Background: Navy gradient (#0B0F2A â†’ #0C1A3D)\n- Headline: 36px bold\n- Subheading: 18px regular\n- Mesh texture overlay at 5% opacity\n- Centered layout, max-width: 1100px\n- Padding: 96px top/bottom\n\n### Footer\n- 3-column structure: Company | Product | Legal\n- Header: 12px uppercase, semibold\n- Text: 14px, 70% opacity\n- Thin divider above\n- Consistent 64px spacing between columns\n\n### Color System\n- **Primary**: #0C1A3D (Deep Sapphire)\n- **Secondary**: #2D65FF (Royal Blue)\n- **Accent**: #7BA7FF (Azure)\n- **Background**: #F5F7FA (Off-White)\n- **Cards**: #FFFFFF (White)\n- **Borders**: rgba(0, 0, 0, 0.08)\n- **Text Primary**: #0A0A0A (Charcoal)\n- **Text Secondary**: #4B4B4B (Gray)\n\n### Typography\n- **H1**: Inter 56px / Bold / Line-height 1.1\n- **H2**: Inter 36px / Semibold / Line-height 1.2\n- **H3**: Inter 24px / Semibold / Line-height 1.3\n- **Body**: Inter 17px / Regular / Line-height 1.6\n- **Microtext**: Inter 14px / Regular\n\n### Spacing Scale (8px-based)\n0, 8, 16, 24, 32, 48, 64, 80, 120\n\n### Shadows\n- **Shadow 1 (Default)**: 0 4px 16px rgba(0, 0, 0, 0.06)\n- **Shadow 2 (Hover)**: 0 8px 24px rgba(0, 0, 0, 0.12)\n\n## External Dependencies\n\n### Google Gemini AI\n- **Purpose**: AI-powered client insights and recommendations.\n- **Authentication**: `GEMINI_API_KEY` environment variable.\n- **Model**: `gemini-2.5-flash` for speed and cost.\n- **Features**: Structured JSON output, custom prompting, batch support.\n\n### NPM Packages\n\n**Production**:\n- `next`: React framework with App Router\n- `react`: UI library\n- `typescript`: Type safety\n- `tailwindcss`: Styling framework\n- `framer-motion`: Animations and micro-interactions\n- `@google/genai`: Gemini AI SDK\n- `xlsx`: Excel/CSV file parsing\n- `zod`: Data validation\n\n**Development**: ESLint for code quality\n\n## Key Features\n\n### Streaming Analysis\n- Real-time batch processing with progress tracking\n- Requests processed in sub-batches of 5 for optimal performance\n- Stream types: status, batch, batch_complete_available, complete, error\n\n### Pagination & Export\n- **Initial Load**: 15 prospects immediately\n- **Subsequent Batches**: 15 more prospects every 60 seconds\n- **Mid-Process Export**: Download available insights while processing\n- **Export Formats**: Text (human-readable) and JSON (structured data)\n- **Progress Display**: Real-time count (X/Y processed) + percentage\n\n### File Support\n- **Formats**: Excel (.xlsx, .xls), CSV (.csv)\n- **File Size**: Max 10MB\n- **Flexible Columns**: NAME/ROLE/COMPANY with alternate column names supported\n- **Optional Fields**: location, description, profile\n\n## Deployment & Publishing\n\n**Production**: Vercel for serverless deployment with environment variable management.\n**Development**: Replit for testing with `npm run dev` on port 5000.\n\n## Status: âœ… PRODUCTION READY - v5.0 (Optimized & Resilient)\n\nAll specifications implemented and tested:\n- âœ… Upload screen as home page (no separate landing page)\n- âœ… Enterprise design system (Stripe/Linear standards)\n- âœ… Time-based pagination (15 initial, 1 min intervals, unlimited prospects)\n- âœ… Mid-process export capability (Text + JSON)\n- âœ… Enhanced Gemini prompt (4 buyer personas, specific pain points, quality checklist)\n- âœ… Real-time progress tracking with percentage and prospect count\n- âœ… Resilient streaming with automatic batch-wise processing on API errors\n- âœ… 5-second response timeout detection with user notification\n- âœ… Graceful error handling - continues processing even if API encounters issues\n- âœ… Responsive design across all devices\n- âœ… Professional animations and micro-interactions\n- âœ… Complete export options (Text + JSON) at any point during processing\n\nReady to deploy and publish to production with enterprise-grade reliability.\n","size_bytes":13971},"app/globals.css":{"content":"@import \"tailwindcss\";\n\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nhtml {\n  scroll-behavior: smooth;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-rendering: optimizeLegibility;\n}\n\n:root {\n  --background: #F5F7FA;\n  --foreground: #0A0A0A;\n  --text-secondary: #4B4B4B;\n  --primary: #0C1A3D;\n  --secondary: #2D65FF;\n  --accent: #7BA7FF;\n  --card-bg: #FFFFFF;\n  --border: rgba(0, 0, 0, 0.08);\n  color-scheme: light;\n}\n\nbody {\n  color: var(--foreground);\n  background: var(--background);\n  font-family: 'Inter', -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n  font-size: 16px;\n  font-weight: 400;\n  line-height: 1.6;\n  letter-spacing: 0;\n  transition: background-color 0.4s ease, color 0.4s ease;\n}\n\na {\n  color: inherit;\n  text-decoration: none;\n  transition: color 0.3s ease, opacity 0.3s ease;\n}\n\na:hover {\n  opacity: 0.85;\n}\n\n/* Button Styles */\nbutton {\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  font-weight: 600;\n  cursor: pointer;\n  border-radius: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  font-size: 0.9375rem;\n  border: none;\n  font-family: inherit;\n}\n\nbutton:active:enabled {\n  transform: scale(0.98);\n}\n\nbutton:disabled {\n  cursor: not-allowed;\n}\n\nbutton:focus-visible,\na:focus-visible,\ninput:focus-visible,\nselect:focus-visible,\ntextarea:focus-visible {\n  outline: 2px solid #3b82f6;\n  outline-offset: 3px;\n}\n\n/* Form Inputs */\ninput[type=\"text\"],\ninput[type=\"email\"],\ninput[type=\"password\"],\ntextarea,\nselect {\n  border: 1px solid #e2e8f0;\n  border-radius: 0.75rem;\n  padding: 0.875rem 1.125rem;\n  font-size: 0.9375rem;\n  transition: all 0.3s ease;\n  background: white;\n  color: #0f172a;\n  font-family: inherit;\n}\n\n@media (prefers-color-scheme: dark) {\n  input[type=\"text\"],\n  input[type=\"email\"],\n  input[type=\"password\"],\n  textarea,\n  select {\n    border: 1px solid #334155;\n    background: #1e293b;\n    color: #f8fafc;\n  }\n}\n\ninput[type=\"text\"]:hover:not(:disabled),\ninput[type=\"email\"]:hover:not(:disabled),\ninput[type=\"password\"]:hover:not(:disabled),\ntextarea:hover:not(:disabled),\nselect:hover:not(:disabled) {\n  border-color: #cbd5e1;\n}\n\n@media (prefers-color-scheme: dark) {\n  input[type=\"text\"]:hover:not(:disabled),\n  input[type=\"email\"]:hover:not(:disabled),\n  input[type=\"password\"]:hover:not(:disabled),\n  textarea:hover:not(:disabled),\n  select:hover:not(:disabled) {\n    border-color: #475569;\n  }\n}\n\ninput[type=\"text\"]:focus,\ninput[type=\"email\"]:focus,\ninput[type=\"password\"]:focus,\ntextarea:focus,\nselect:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);\n}\n\n@media (prefers-color-scheme: dark) {\n  input[type=\"text\"]:focus,\n  input[type=\"email\"]:focus,\n  input[type=\"password\"]:focus,\n  textarea:focus,\n  select:focus {\n    border-color: #60a5fa;\n    box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.25);\n  }\n}\n\n/* Scrollbar */\n::-webkit-scrollbar {\n  width: 10px;\n  height: 10px;\n}\n\n::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n  background: linear-gradient(to bottom, #cbd5e1, #94a3b8);\n  border-radius: 5px;\n  border: 2px solid transparent;\n  background-clip: padding-box;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: linear-gradient(to bottom, #94a3b8, #64748b);\n  background-clip: padding-box;\n}\n\n@media (prefers-color-scheme: dark) {\n  ::-webkit-scrollbar-thumb {\n    background: linear-gradient(to bottom, #475569, #334155);\n    background-clip: padding-box;\n  }\n\n  ::-webkit-scrollbar-thumb:hover {\n    background: linear-gradient(to bottom, #64748b, #475569);\n    background-clip: padding-box;\n  }\n}\n\n/* Typography - Enterprise Premium System */\nh1 {\n  font-size: 3.5rem;\n  font-weight: 700;\n  line-height: 1.1;\n  letter-spacing: -0.02em;\n  margin: 0;\n  color: #0C1A3D;\n}\n\nh2 {\n  font-size: 2.25rem;\n  font-weight: 600;\n  line-height: 1.2;\n  letter-spacing: -0.01em;\n  margin: 0;\n  color: #0C1A3D;\n}\n\nh3 {\n  font-size: 1.5rem;\n  font-weight: 600;\n  line-height: 1.3;\n  margin: 0;\n  color: #0C1A3D;\n}\n\nh4 {\n  font-size: 1.25rem;\n  font-weight: 600;\n  line-height: 1.5;\n  margin: 0;\n  color: #0C1A3D;\n}\n\nbody {\n  font-size: 1.0625rem;\n  font-weight: 400;\n  line-height: 1.6;\n}\n\np {\n  margin: 0;\n  line-height: 1.7;\n}\n\n@media (max-width: 640px) {\n  h1 {\n    font-size: 2.25rem;\n    line-height: 1.1;\n  }\n  \n  h2 {\n    font-size: 1.75rem;\n    line-height: 1.2;\n  }\n\n  h3 {\n    font-size: 1.25rem;\n  }\n}\n\n/* Utilities */\n.text-xs {\n  font-size: 0.75rem;\n  line-height: 1rem;\n  letter-spacing: 0.02em;\n}\n\n.text-sm {\n  font-size: 0.875rem;\n  line-height: 1.4;\n  letter-spacing: 0.005em;\n}\n\n.text-base {\n  font-size: 1rem;\n  line-height: 1.6;\n}\n\n.text-lg {\n  font-size: 1.125rem;\n  line-height: 1.7;\n}\n\n.text-xl {\n  font-size: 1.25rem;\n  line-height: 1.75;\n}\n\n/* Selection */\n::selection {\n  background: #2D65FF;\n  color: #ffffff;\n}\n\n/* Premium Animations */\n@keyframes slideInRight {\n  from {\n    opacity: 0;\n    transform: translateX(30px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n@keyframes slideInLeft {\n  from {\n    opacity: 0;\n    transform: translateX(-30px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n@keyframes slideInUp {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes slideInDown {\n  from {\n    opacity: 0;\n    transform: translateY(-20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes scaleIn {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes pulse-glow {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.7;\n  }\n}\n\n@keyframes shimmer {\n  0% {\n    background-position: -1000px 0;\n  }\n  100% {\n    background-position: 1000px 0;\n  }\n}\n\n.animate-slideInRight {\n  animation: slideInRight 0.6s ease-out;\n}\n\n.animate-slideInLeft {\n  animation: slideInLeft 0.6s ease-out;\n}\n\n.animate-slideInUp {\n  animation: slideInUp 0.6s ease-out;\n}\n\n.animate-slideInDown {\n  animation: slideInDown 0.6s ease-out;\n}\n\n.animate-scaleIn {\n  animation: scaleIn 0.5s ease-out;\n}\n\n.animate-fadeIn {\n  animation: fadeIn 0.4s ease-out;\n}\n\n.animate-pulse-glow {\n  animation: pulse-glow 2s ease-in-out infinite;\n}\n\n/* Smooth transitions */\nbody,\nbody * {\n  transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;\n}\n\nbutton,\na {\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n/* Minimum touch target size */\nbutton,\na[role=\"button\"],\ninput[type=\"checkbox\"],\ninput[type=\"radio\"],\nselect {\n  min-height: 44px;\n  min-width: 44px;\n}\n\n@media (pointer: fine) {\n  button,\n  a[role=\"button\"],\n  input[type=\"checkbox\"],\n  input[type=\"radio\"],\n  select {\n    min-height: auto;\n    min-width: auto;\n  }\n}\n\n/* Backdrop blur support */\n@supports (backdrop-filter: blur(1px)) {\n  .backdrop-blur-xl {\n    backdrop-filter: blur(12px);\n  }\n}\n","size_bytes":6991},"DEVELOPER_DOCUMENTATION.md":{"content":"# Cehpoint Client Insight Engine (CCIE) - Developer Documentation\n\n## Table of Contents\n1. [Overview](#overview)\n2. [Architecture](#architecture)\n3. [Setup & Installation](#setup--installation)\n4. [API Key Rotation System](#api-key-rotation-system)\n5. [Deployment](#deployment)\n6. [File Structure](#file-structure)\n7. [Key Features](#key-features)\n8. [Troubleshooting](#troubleshooting)\n\n---\n\n## Overview\n\nThe **Cehpoint Client Insight Engine (CCIE)** is a production-ready Next.js 15 application that transforms LinkedIn prospect data into actionable B2B sales insights using Google Gemini AI.\n\n### Tech Stack\n- **Frontend**: Next.js 15 (App Router), React 19, TailwindCSS 4\n- **Backend**: Next.js Server Actions\n- **AI**: Google Gemini API (2.5-flash) with key rotation\n- **File Processing**: XLSX library for Excel/CSV parsing\n- **Deployment**: Vercel-ready, serverless architecture\n\n---\n\n## Architecture\n\n### Application Flow\n```\nUser Upload â†’ File Validation â†’ Parse (XLSX/CSV) â†’ \nAI Analysis (Gemini) â†’ Structured Insights â†’ Display/Download\n```\n\n### Directory Structure\n```\ncehpoint-client-insight-engine/\nâ”œâ”€â”€ app/\nâ”‚   â”œâ”€â”€ components/\nâ”‚   â”‚   â””â”€â”€ Logo.tsx              # Brand logo component\nâ”‚   â”œâ”€â”€ upload/\nâ”‚   â”‚   â”œâ”€â”€ page.tsx              # Upload interface\nâ”‚   â”‚   â””â”€â”€ actions.ts            # Server actions for file processing\nâ”‚   â”œâ”€â”€ layout.tsx                # Root layout with metadata\nâ”‚   â”œâ”€â”€ page.tsx                  # Landing page\nâ”‚   â””â”€â”€ globals.css               # Global styles with Tailwind\nâ”œâ”€â”€ lib/\nâ”‚   â”œâ”€â”€ gemini.ts                 # Gemini AI service with key rotation\nâ”‚   â”œâ”€â”€ files.ts                  # File parsing utilities\nâ”‚   â””â”€â”€ types/\nâ”‚       â””â”€â”€ index.ts              # TypeScript interfaces\nâ”œâ”€â”€ public/\nâ”‚   â””â”€â”€ favicon.svg               # Site favicon\nâ”œâ”€â”€ test_data/\nâ”‚   â”œâ”€â”€ sample_prospects.csv      # Sample data for testing\nâ”‚   â””â”€â”€ real_prospects.csv        # Real LinkedIn data\nâ”œâ”€â”€ next.config.ts                # Next.js configuration\nâ”œâ”€â”€ package.json                  # Dependencies\nâ””â”€â”€ README.md                     # User-facing documentation\n```\n\n---\n\n## Setup & Installation\n\n### Prerequisites\n- Node.js 18+ \n- npm or yarn\n- Google Gemini API key(s)\n\n### Local Development\n\n1. **Clone the repository**\n   ```bash\n   git clone <your-repo-url>\n   cd cehpoint-client-insight-engine\n   ```\n\n2. **Install dependencies**\n   ```bash\n   npm install\n   ```\n\n3. **Set up environment variables**\n   \n   Create a `.env.local` file:\n   ```env\n   # Required\n   GEMINI_API_KEY_PRIMARY=your_primary_api_key_here\n   \n   # Recommended (for reliability)\n   GEMINI_API_KEY_SECONDARY=your_secondary_api_key_here\n   GEMINI_API_KEY_EXTRA_1=your_third_api_key_here\n   \n   # Optional (maximum reliability)\n   # GEMINI_API_KEY_EXTRA_2=your_fourth_api_key_here\n   # GEMINI_API_KEY_EXTRA_3=your_fifth_api_key_here\n   # GEMINI_API_KEY_EXTRA_4=your_sixth_api_key_here\n   # GEMINI_API_KEY_EXTRA_5=your_seventh_api_key_here\n   ```\n\n   **Get API Keys**: Visit [Google AI Studio](https://ai.google.dev) to generate free API keys.\n   \n   **Backward Compatibility**: Legacy variable names (`GEMINI_API_KEY`, `GEMINI_API_KEY_2`) are still supported.\n\n4. **Run development server**\n   ```bash\n   npm run dev\n   ```\n   Open [http://localhost:5000](http://localhost:5000)\n\n---\n\n## Production-Grade Error Handling System (v5.2)\n\n### Overview\n\nThe application features a comprehensive error handling infrastructure with multi-API-key rotation, exponential backoff retry logic, and intelligent cooldown management.\n\n### Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  API Route (analyze/expand/regenerate)          â”‚\nâ”‚  - Outer retry loop (10 attempts)               â”‚\nâ”‚  - Catches RateLimitError, waits & retries      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                  â”‚\n                  â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  GeminiClient (lib/gemini-client.ts)            â”‚\nâ”‚  - Multi-key rotation (PRIMARY â†’ SECONDARY)     â”‚\nâ”‚  - Inner retry loop (5 attempts)                â”‚\nâ”‚  - Exponential backoff (1s â†’ 60s max)           â”‚\nâ”‚  - Per-key cooldown management                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                  â”‚\n                  â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Error Classification (lib/errors.ts)           â”‚\nâ”‚  - RateLimitError (429) â†’ Wait & retry          â”‚\nâ”‚  - AuthError (401/403) â†’ Switch key             â”‚\nâ”‚  - TransientAPIError (5xx) â†’ Retry              â”‚\nâ”‚  - FatalAPIError (400) â†’ Stop immediately       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Key Components\n\n#### 1. Error Classification (`lib/errors.ts`)\n\n```typescript\n// 5 error types for granular handling\nexport class RateLimitError extends Error {\n  constructor(message: string, public retryAfter?: number) {}\n}\nexport class AuthError extends Error {}\nexport class ValidationError extends Error {}\nexport class TransientAPIError extends Error {}\nexport class FatalAPIError extends Error {}\n```\n\n#### 2. Retry Utilities (`lib/retry.ts`)\n\n```typescript\n// Exponential backoff: 1s â†’ 2s â†’ 4s â†’ 8s â†’ 16s (max 60s)\nexport async function retryWithBackoff<T>(\n  fn: () => Promise<T>,\n  config: RetryConfig = { maxAttempts: 5, baseDelay: 1000, maxDelay: 60000 }\n): Promise<T>\n```\n\n#### 3. GeminiClient (`lib/gemini-client.ts`)\n\n```typescript\n// Multi-key rotation with cooldown management\nexport class GeminiClient {\n  private keys: APIKey[] = []; // PRIMARY, SECONDARY, EXTRA_1-5\n  \n  async callWithRetry(options, onRetry?): Promise<string> {\n    // Inner retry loop: 5 attempts with exponential backoff\n    // Rotates through available keys\n    // Failed keys enter cooldown (60s standard, 5min auth errors)\n  }\n}\n```\n\n### Environment Variables\n\n#### Required\n- `GEMINI_API_KEY_PRIMARY` - Primary API key (fallback: `GEMINI_API_KEY`)\n\n#### Optional (Recommended for Reliability)\n- `GEMINI_API_KEY_SECONDARY` - Secondary API key for failover\n- `GEMINI_API_KEY_EXTRA_1` through `GEMINI_API_KEY_EXTRA_5` - Additional keys\n\n### Error Handling Flow\n\n#### Scenario 1: Rate Limit Exceeded (Single Key)\n```\n1. Request fails with 429 error\n2. GeminiClient classifies as RateLimitError\n3. Exponential backoff: wait 1s\n4. Retry #1 fails â†’ wait 2s\n5. Retry #2 fails â†’ wait 4s\n6. Retry #3 succeeds âœ“\n```\n\n#### Scenario 2: All Keys on Cooldown\n```\n1. All keys hit rate limit\n2. GeminiClient throws RateLimitError(retryAfter: 60)\n3. Outer loop catches error\n4. Waits 60 seconds\n5. Retries entire operation\n6. Keys recovered â†’ succeeds âœ“\n```\n\n#### Scenario 3: Authentication Failure\n```\n1. PRIMARY key fails with 401 error\n2. GeminiClient classifies as AuthError\n3. PRIMARY enters 5-minute cooldown\n4. Switches to SECONDARY key\n5. Request succeeds with SECONDARY âœ“\n```\n\n### Benefits\n1. **Automatic Failover**: If one key hits rate limits, automatically switches to the next\n2. **Load Distribution**: Distributes API calls across multiple keys\n3. **Zero Downtime**: Continues working even if one key fails\n4. **Scalable**: Add more keys by creating `GEMINI_API_KEY_3`, `GEMINI_API_KEY_4`, etc.\n\n### Configuration\n\n**For Replit:**\nUse the Secrets tab to add:\n- `GEMINI_API_KEY_PRIMARY` (required)\n- `GEMINI_API_KEY_SECONDARY` (recommended)\n- `GEMINI_API_KEY_EXTRA_1` through `GEMINI_API_KEY_EXTRA_5` (optional)\n\n**For Vercel:**\nAdd in Project Settings â†’ Environment Variables (see `DEPLOYMENT_GUIDE.md`)\n\n**For Local Development:**\nAdd to `.env.local` (never commit this file!)\n\n### Monitoring & Telemetry\n\nThe system logs detailed retry telemetry for debugging:\n\n```bash\n[Gemini API] Analyzing 5 prospect(s)...\n[Gemini API] Retry attempt 2/5 after 2.0s (key: primary, error: Rate limit exceeded)\n[Gemini API] All keys on cooldown. Waiting 60s before retry (attempt 1/10)...\n[Gemini API] âœ“ Successfully generated insights for 5 prospect(s)\n```\n\nCheck console logs to monitor:\n- Which keys are being used\n- Retry patterns and delays\n- Cooldown periods\n- Success/failure rates\n\n---\n\n## Deployment\n\n### Deploy to Vercel (Recommended)\n\n1. **Push to GitHub**\n   ```bash\n   git init\n   git add .\n   git commit -m \"Initial commit\"\n   git remote add origin <your-repo-url>\n   git push -u origin main\n   ```\n\n2. **Import to Vercel**\n   - Go to [vercel.com](https://vercel.com)\n   - Click \"New Project\"\n   - Import your GitHub repository\n   - Add environment variables:\n     - `GEMINI_API_KEY`\n     - `GEMINI_API_KEY_2`\n   - Click \"Deploy\"\n\n3. **Automatic Deployments**\n   - Every push to `main` triggers a production deployment\n   - Pull requests get preview deployments\n\n### Serverless Configuration\n\nThe app is optimized for serverless environments:\n\n```typescript\n// next.config.ts\nconst nextConfig: NextConfig = {\n  serverExternalPackages: [\"xlsx\"],  // Prevents bundling issues\n};\n```\n\n**Why serverless?**\n- Zero server management\n- Auto-scaling based on traffic\n- Pay only for actual usage\n- Global CDN distribution\n\n---\n\n## File Structure\n\n### Key Files Explained\n\n#### `lib/gemini.ts` - AI Service Layer\n```typescript\nexport async function generateClientInsights(\n  leads: LeadRecord[]\n): Promise<ClientInsightReport>\n```\n- Handles all Gemini API communication\n- Implements key rotation logic\n- Validates and parses AI responses\n- Enforces JSON schema for consistent output\n\n#### `lib/files.ts` - File Processing\n```typescript\nexport async function parseExcelFile(file: File): Promise<LeadRecord[]>\nexport async function parseCSVFile(file: File): Promise<LeadRecord[]>\n```\n- Supports Excel (.xlsx, .xls) and CSV formats\n- Flexible column mapping (case-insensitive)\n- Filters out incomplete records\n\n#### `app/upload/actions.ts` - Server Actions\n```typescript\nexport async function processLeadFile(\n  formData: FormData\n): Promise<UploadResult>\n```\n- Validates file type and size\n- Orchestrates parsing â†’ AI analysis â†’ response\n- Returns structured insights or error messages\n\n#### `lib/types/index.ts` - Type Definitions\n```typescript\nexport interface LeadRecord { ... }\nexport interface ProspectInsight { ... }\nexport interface ClientInsightReport { ... }\n```\n- Ensures type safety across the application\n- Matches Gemini API response schema\n\n---\n\n## Key Features\n\n### 1. File Upload & Parsing\n\n**Supported Formats:**\n- Excel: `.xlsx`, `.xls`\n- CSV: `.csv`\n\n**Required Columns** (case-insensitive):\n- `name` or `full_name`\n- `role`, `title`, or `occupation`\n- `company` or `organization`\n- `location` (optional)\n- `description`, `profile`, `work_positions` (optional)\n\n**Example CSV:**\n```csv\nname,role,company,location,description\nJohn Doe,CTO,TechCorp,San Francisco,Building scalable systems\n```\n\n### 2. AI-Powered Analysis\n\nThe Gemini API analyzes each prospect to generate:\n\n1. **Ideal Client Framework**\n   - Categorizes prospects by type (Founders, CTOs, etc.)\n   - Identifies common needs per category\n\n2. **Prospect-Level Insights**\n   - Profile analysis\n   - 3 tailored pitch suggestions\n   - Personalized conversation starter\n\n**Example Output:**\n```json\n{\n  \"prospectInsights\": [\n    {\n      \"name\": \"Deepak Kumar\",\n      \"role\": \"Co-founder & CTO\",\n      \"profileNotes\": \"Building consumer tech with scaling needs\",\n      \"pitchSuggestions\": [\n        {\"pitch\": \"Security review + vulnerability assessment\"},\n        {\"pitch\": \"Dedicated feature development pod\"},\n        {\"pitch\": \"Backend architecture optimization\"}\n      ],\n      \"conversationStarter\": \"Deepak, I reviewed your role at Hood...\"\n    }\n  ]\n}\n```\n\n### 3. Download Options\n\n**TXT Format:**\nFormatted report for human reading, perfect for:\n- Email templates\n- Internal team sharing\n- Quick reference\n\n**JSON Format:**\nStructured data for:\n- CRM integration\n- Further processing\n- Automation workflows\n\n### 4. Modern UI/UX\n\n- **Responsive Design**: Works on desktop, tablet, and mobile\n- **Dark Mode**: Automatic theme switching based on system preference\n- **Accessibility**: ARIA labels, keyboard navigation\n- **Loading States**: Real-time feedback during processing\n- **Error Handling**: Clear, actionable error messages\n\n---\n\n## Environment Variables\n\n| Variable | Required | Description |\n|----------|----------|-------------|\n| `GEMINI_API_KEY` | Yes | Primary Google Gemini API key |\n| `GEMINI_API_KEY_2` | Recommended | Secondary API key for rotation |\n| `NODE_ENV` | Auto-set | `development` or `production` |\n\n---\n\n## Troubleshooting\n\n### Common Issues\n\n**1. \"Failed to generate insights\" Error**\n- **Cause**: Invalid or rate-limited API key\n- **Solution**: \n  - Verify API keys in environment variables\n  - Check [Google AI Studio](https://ai.google.dev) quota\n  - Add a second API key for rotation\n\n**2. \"No valid prospect data found\"**\n- **Cause**: Missing required columns (name, role, company)\n- **Solution**: \n  - Ensure CSV/Excel has `name`, `role`, `company` columns\n  - Column names are case-insensitive\n\n**3. Workflow fails to start on Replit**\n- **Cause**: Port mismatch\n- **Solution**: Ensure `package.json` scripts use `--port 5000`\n\n**4. Vercel deployment fails**\n- **Cause**: Missing environment variables or build errors\n- **Solution**:\n  - Add API keys in Vercel dashboard\n  - Check build logs for specific errors\n  - Ensure `next.config.ts` includes `serverExternalPackages: [\"xlsx\"]`\n\n**5. File upload returns \"Invalid file type\"**\n- **Cause**: Unsupported file format\n- **Solution**: Use `.xlsx`, `.xls`, or `.csv` files only\n\n---\n\n## Performance Optimization\n\n### Serverless Best Practices\n\n1. **Cold Start Mitigation**\n   - Keep dependencies minimal\n   - Use `serverExternalPackages` for large libraries\n\n2. **Memory Management**\n   - Process files in streams for large datasets\n   - Current limit: 10MB per file\n\n3. **AI Response Time**\n   - Typically 30-60 seconds per batch\n   - Use Gemini Flash model (faster than Pro)\n\n### Scaling Considerations\n\n**Current Limits:**\n- Free Gemini API: 1,500 requests/day per key\n- With 2 keys: ~3,000 requests/day\n- File size: 10MB max\n\n**To Scale Further:**\n1. Add more API keys (`GEMINI_API_KEY_3`, etc.)\n2. Implement request queuing\n3. Consider Gemini Pro with higher quotas\n4. Add Redis caching for repeated analyses\n\n---\n\n## Security\n\n### Best Practices Implemented\n\nâœ… **API Key Protection**\n- Never expose keys in client-side code\n- Server-side only access\n- Use environment variables\n\nâœ… **File Validation**\n- Type checking (Excel/CSV only)\n- Size limits (10MB)\n- Sanitized file parsing\n\nâœ… **Input Sanitization**\n- Validates all prospect data\n- Filters incomplete records\n- JSON schema validation on AI output\n\nâœ… **Error Handling**\n- Never expose internal errors to users\n- Logs detailed errors server-side\n- User-friendly error messages\n\n---\n\n## API Reference\n\n### Server Actions\n\n#### `processLeadFile(formData: FormData)`\n\n**Parameters:**\n- `formData`: FormData object containing uploaded file\n\n**Returns:**\n```typescript\n{\n  success: boolean;\n  message?: string;\n  insights?: ClientInsightReport;\n  error?: string;\n}\n```\n\n**Example Usage:**\n```typescript\nconst formData = new FormData();\nformData.append('file', file);\nconst result = await processLeadFile(formData);\n```\n\n---\n\n## Testing\n\n### Test Files Provided\n\n1. **`test_data/sample_prospects.csv`**\n   - 5 sample prospects\n   - Good for quick testing\n\n2. **`test_data/real_prospects.csv`**\n   - 20 real LinkedIn profiles\n   - Comprehensive test case\n\n### Manual Testing Checklist\n\n- [ ] Upload sample CSV file\n- [ ] Verify AI generates insights\n- [ ] Download TXT report\n- [ ] Download JSON export\n- [ ] Test error handling (invalid file)\n- [ ] Test dark mode toggle\n- [ ] Test mobile responsiveness\n\n---\n\n## Contributing\n\n### Development Workflow\n\n1. Create feature branch\n   ```bash\n   git checkout -b feature/your-feature\n   ```\n\n2. Make changes and test locally\n\n3. Commit with clear messages\n   ```bash\n   git commit -m \"feat: add prospect filtering\"\n   ```\n\n4. Push and create PR\n   ```bash\n   git push origin feature/your-feature\n   ```\n\n### Code Style\n\n- **TypeScript**: Strict mode enabled\n- **Formatting**: Use Prettier\n- **Linting**: ESLint with Next.js config\n- **Naming**: camelCase for variables, PascalCase for components\n\n---\n\n## License\n\nProprietary - Cehpoint Internal Tool\n\n---\n\n## Support\n\nFor technical issues or questions:\n- **Documentation**: This file\n- **Issues**: GitHub Issues\n- **Email**: dev@cehpoint.com\n\n---\n\n## Changelog\n\n### v1.0.0 (Current)\n- âœ¨ Initial release\n- ğŸ” API key rotation system\n- ğŸ“Š Excel/CSV file parsing\n- ğŸ¤– Gemini AI integration\n- ğŸ“± Responsive UI with dark mode\n- â˜ï¸ Vercel deployment ready\n- ğŸ“„ TXT and JSON export options\n\n---\n\n**Last Updated**: November 2025  \n**Maintained by**: Cehpoint Development Team\n","size_bytes":17494},"lib/files.ts":{"content":"import * as XLSX from \"xlsx\";\nimport { LeadRecord } from \"./types\";\n\n// Maximum prospects to process per file\nconst MAX_PROSPECTS = 15;\n\nexport async function parseExcelFile(file: File): Promise<LeadRecord[]> {\n  const arrayBuffer = await file.arrayBuffer();\n  const workbook = XLSX.read(arrayBuffer, { type: \"array\" });\n  \n  const firstSheet = workbook.Sheets[workbook.SheetNames[0]];\n  const jsonData = XLSX.utils.sheet_to_json<any>(firstSheet);\n  \n  const leads: LeadRecord[] = jsonData.map((row) => ({\n    name: row.name || row.Name || row.NAME || row.full_name || row.Full_Name || row.FULL_NAME || \"\",\n    role: row.role || row.Role || row.ROLE || row.title || row.Title || row.occupation || row.Occupation || \"\",\n    company: row.company || row.Company || row.COMPANY || row.organization || row.Organization || \"\",\n    location: row.location || row.Location || row.LOCATION || \"\",\n    description: row.description || row.Description || row.DESCRIPTION || row.profile || row.Profile || row.work_positions || row.education || \"\",\n  }));\n  \n  // Filter for valid leads, then limit to MAX_PROSPECTS\n  const validLeads = leads.filter(lead => lead.name && lead.role);\n  return validLeads.slice(0, MAX_PROSPECTS);\n}\n\nexport async function parseCSVFile(file: File): Promise<LeadRecord[]> {\n  const text = await file.text();\n  const workbook = XLSX.read(text, { type: \"string\" });\n  \n  const firstSheet = workbook.Sheets[workbook.SheetNames[0]];\n  const jsonData = XLSX.utils.sheet_to_json<any>(firstSheet);\n  \n  const leads: LeadRecord[] = jsonData.map((row) => ({\n    name: row.name || row.Name || row.NAME || row.full_name || row.Full_Name || row.FULL_NAME || \"\",\n    role: row.role || row.Role || row.ROLE || row.title || row.Title || row.occupation || row.Occupation || \"\",\n    company: row.company || row.Company || row.COMPANY || row.organization || row.Organization || \"\",\n    location: row.location || row.Location || row.LOCATION || \"\",\n    description: row.description || row.Description || row.DESCRIPTION || row.profile || row.Profile || row.work_positions || row.education || \"\",\n  }));\n  \n  // Filter for valid leads, then limit to MAX_PROSPECTS\n  const validLeads = leads.filter(lead => lead.name && lead.role);\n  return validLeads.slice(0, MAX_PROSPECTS);\n}\n\nexport function validateFileType(file: File): boolean {\n  const validTypes = [\n    \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\", // .xlsx\n    \"application/vnd.ms-excel\", // .xls\n    \"text/csv\", // .csv\n  ];\n  \n  const validExtensions = [\".xlsx\", \".xls\", \".csv\"];\n  const hasValidExtension = validExtensions.some(ext => file.name.toLowerCase().endsWith(ext));\n  \n  return validTypes.includes(file.type) || hasValidExtension;\n}\n\nexport function validateFileSize(file: File, maxSizeMB: number = 10): boolean {\n  const maxSizeBytes = maxSizeMB * 1024 * 1024;\n  return file.size <= maxSizeBytes;\n}\n","size_bytes":2889},"lib/types/index.ts":{"content":"export interface LeadRecord {\n  name: string;\n  role: string;\n  company: string;\n  location?: string;\n  description?: string;\n}\n\nexport interface PitchSuggestion {\n  pitch: string;\n}\n\nexport interface ProspectInsight {\n  name: string;\n  role: string;\n  company: string;\n  location?: string;\n  description?: string;\n  profileNotes: string;\n  pitchSuggestions: PitchSuggestion[];\n  conversationStarter: string;\n}\n\nexport interface ClientInsightReport {\n  idealClientFramework: {\n    category: string;\n    description: string;\n    needs: string[];\n  }[];\n  prospectInsights: ProspectInsight[];\n  generatedAt: string;\n}\n","size_bytes":616},"app/upload/page.tsx":{"content":"\"use client\";\n\nimport { useState } from \"react\";\nimport { ClientInsightReport, ProspectInsight } from \"@/lib/types\";\nimport Link from \"next/link\";\nimport Logo from \"../components/Logo\";\n\ninterface BatchUpdate {\n  type: string;\n  batchNumber?: number;\n  totalBatches?: number;\n  batches?: number;\n  prospects?: ProspectInsight[];\n  progress?: number;\n  message?: string;\n  report?: ClientInsightReport;\n  currentReport?: ClientInsightReport;\n  totalProcessed?: number;\n  totalInFile?: number;\n  isProcessing?: boolean;\n}\n\nexport default function UploadPage() {\n  const [isPending, setIsPending] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [insights, setInsights] = useState<ClientInsightReport | null>(null);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [streamingInsights, setStreamingInsights] = useState<ProspectInsight[]>([]);\n  const [streamingProgress, setStreamingProgress] = useState(0);\n  const [streamingMessage, setStreamingMessage] = useState(\"\");\n  const [totalInFile, setTotalInFile] = useState(0);\n  const [totalProcessed, setTotalProcessed] = useState(0);\n  const [availableForExport, setAvailableForExport] = useState<ClientInsightReport | null>(null);\n  const [isStillProcessing, setIsStillProcessing] = useState(false);\n\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      setSelectedFile(file);\n      setError(null);\n    }\n  };\n\n  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    setIsPending(true);\n    setError(null);\n    setStreamingInsights([]);\n    setStreamingProgress(0);\n    setStreamingMessage(\"\");\n    setTotalInFile(0);\n    setTotalProcessed(0);\n    setAvailableForExport(null);\n    setIsStillProcessing(false);\n\n    const formData = new FormData(event.currentTarget);\n\n    try {\n      const response = await fetch(\"/api/analyze\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to analyze file\");\n      }\n\n      const reader = response.body?.getReader();\n      if (!reader) throw new Error(\"No response body\");\n\n      const decoder = new TextDecoder();\n      let buffer = \"\";\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split(\"\\n\");\n        buffer = lines.pop() || \"\";\n\n        for (const line of lines) {\n          if (!line.trim()) continue;\n\n          try {\n            const update: BatchUpdate = JSON.parse(line);\n\n            // Handle different message types\n            if (update.type === \"status\") {\n              setStreamingMessage(update.message || \"Starting analysis...\");\n              setTotalInFile(update.totalInFile || 0);\n            }\n\n            if (update.type === \"batch\" && update.prospects) {\n              setStreamingInsights(prev => [...prev, ...update.prospects!]);\n              setTotalProcessed(update.totalProcessed || 0);\n              setTotalInFile(update.totalInFile || 0);\n              const progressPercent = update.totalInFile \n                ? Math.round(((update.totalProcessed ?? 0) / update.totalInFile) * 100) \n                : 0;\n              setStreamingProgress(progressPercent);\n              setIsStillProcessing(update.isProcessing === true);\n            }\n\n            if (update.type === \"batch_complete_available\" && update.currentReport) {\n              setAvailableForExport(update.currentReport);\n              setTotalProcessed(update.totalProcessed || 0);\n              setTotalInFile(update.totalInFile || 0);\n              setStreamingMessage(update.message || \"Processing more data...\");\n              setIsStillProcessing(update.isProcessing === true);\n              const progressPercent = update.totalInFile \n                ? Math.round(((update.totalProcessed ?? 0) / update.totalInFile) * 100) \n                : 0;\n              setStreamingProgress(progressPercent);\n            }\n\n            if (update.type === \"complete\" && update.report) {\n              setInsights(update.report);\n              setStreamingProgress(100);\n              setStreamingMessage(\"Analysis complete!\");\n              setIsStillProcessing(false);\n              setIsPending(false);\n            }\n          } catch {\n            // Continue parsing\n          }\n        }\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"An error occurred\");\n      setIsPending(false);\n    }\n  };\n\n  const downloadInsights = (report: ClientInsightReport | null = null) => {\n    const dataToExport = report || insights;\n    if (!dataToExport) return;\n    \n    const text = dataToExport.prospectInsights\n      .map(p => `${p.name} (${p.role})\\n${p.profileNotes}\\n\\nPitches:\\n${p.pitchSuggestions.map((s, i) => `${i + 1}. ${s.pitch}`).join(\"\\n\")}\\n\\nOpening:\\n\"${p.conversationStarter}\"\\n`)\n      .join(\"\\n---\\n\");\n    \n    const blob = new Blob([text], { type: \"text/plain\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `cehpoint-insights-${new Date().toISOString().split(\"T\")[0]}.txt`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  const downloadJSON = (report: ClientInsightReport | null = null) => {\n    const dataToExport = report || insights;\n    if (!dataToExport) return;\n    \n    const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: \"application/json\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `cehpoint-insights-${new Date().toISOString().split(\"T\")[0]}.json`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-white text-slate-950\">\n      {/* Navigation */}\n      <nav className=\"sticky top-0 z-50 border-b border-slate-100 bg-white/80 backdrop-blur-md\">\n        <div className=\"max-w-6xl mx-auto px-6 lg:px-8 h-16 flex items-center justify-between\">\n          <Link href=\"/\" className=\"hover:opacity-70 transition-opacity\">\n            <Logo />\n          </Link>\n          <div className=\"text-xs font-semibold text-slate-600 tracking-widest uppercase\">\n            Analysis Engine\n          </div>\n        </div>\n      </nav>\n\n      {/* Main Content */}\n      <div className=\"flex-1 max-w-4xl mx-auto w-full py-20 px-6 lg:px-8\">\n        {!insights && streamingInsights.length === 0 ? (\n          <div className=\"space-y-16\">\n            {/* Header */}\n            <div className=\"text-center space-y-4\">\n              <h1 className=\"text-5xl lg:text-6xl font-bold text-slate-950\">\n                Upload & Analyze\n              </h1>\n              <p className=\"text-xl text-slate-600 max-w-2xl mx-auto\">\n                Share your prospect data and receive personalized sales intelligence instantly\n              </p>\n            </div>\n\n            {/* Upload Form */}\n            <div className=\"bg-slate-50 border-2 border-slate-200 rounded-2xl p-12 lg:p-16\">\n              <form onSubmit={handleSubmit} className=\"space-y-8\">\n                {/* File Upload */}\n                <div className=\"space-y-6 pb-8 border-b border-slate-200\">\n                  <div>\n                    <label htmlFor=\"file\" className=\"block text-2xl font-bold text-slate-950 mb-2\">\n                      Select Your Data File\n                    </label>\n                    <p className=\"text-slate-600\">Upload your prospect list (Excel or CSV)</p>\n                  </div>\n\n                  <input\n                    type=\"file\"\n                    id=\"file\"\n                    name=\"file\"\n                    accept=\".xlsx,.xls,.csv\"\n                    required\n                    disabled={isPending}\n                    onChange={handleFileChange}\n                    className=\"hidden\"\n                  />\n                  <label\n                    htmlFor=\"file\"\n                    className={`flex flex-col items-center justify-center w-full px-8 py-12 border-2 border-dashed rounded-xl cursor-pointer transition-all ${\n                      selectedFile\n                        ? \"border-green-500 bg-green-50\"\n                        : \"border-slate-300 hover:border-slate-400 bg-white hover:bg-slate-50\"\n                    }`}\n                  >\n                    <svg className=\"w-12 h-12 mb-3 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33A3 3 0 0116.5 19.5H6.75z\" />\n                    </svg>\n                    {selectedFile ? (\n                      <p className=\"font-semibold text-slate-950\">âœ“ {selectedFile.name}</p>\n                    ) : (\n                      <div className=\"text-center\">\n                        <p className=\"font-semibold text-slate-950\">Click to upload or drag & drop</p>\n                        <p className=\"text-sm text-slate-600 mt-1\">Excel or CSV â€¢ Up to 10 MB</p>\n                      </div>\n                    )}\n                  </label>\n                </div>\n\n                {/* Required Columns */}\n                <div className=\"space-y-6\">\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-slate-950 mb-4\">Required Columns</h3>\n                    <div className=\"grid md:grid-cols-3 gap-4\">\n                      {[\n                        { col: \"NAME\", options: [\"name\", \"full_name\"] },\n                        { col: \"ROLE\", options: [\"role\", \"title\"] },\n                        { col: \"COMPANY\", options: [\"company\", \"org\"] }\n                      ].map((req, idx) => (\n                        <div key={idx} className=\"p-4 bg-white border border-slate-200 rounded-lg\">\n                          <p className=\"font-semibold text-slate-950 mb-3 text-sm uppercase\">{req.col}</p>\n                          <div className=\"space-y-2\">\n                            {req.options.map((opt, i) => (\n                              <div key={i}>\n                                <code className=\"block px-3 py-2 bg-slate-100 rounded text-sm text-slate-950 font-mono\">{opt}</code>\n                                {i === 0 && <p className=\"text-center text-xs text-slate-500 py-1\">or</p>}\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n\n                  <div className=\"p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n                    <p className=\"text-sm text-slate-700\">\n                      <strong>Optional:</strong> location, description, profile\n                    </p>\n                  </div>\n                </div>\n\n                {/* Error */}\n                {error && (\n                  <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg\">\n                    <p className=\"text-sm text-red-700\">âš ï¸ {error}</p>\n                  </div>\n                )}\n\n                {/* Submit */}\n                <button\n                  type=\"submit\"\n                  disabled={isPending || !selectedFile}\n                  className=\"w-full py-4 bg-slate-950 text-white font-semibold rounded-lg hover:bg-slate-900 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\n                >\n                  {isPending ? \"Analyzing...\" : \"Analyze Prospects\"}\n                </button>\n              </form>\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-12\">\n            {/* Progress Indicator */}\n            {!insights && streamingInsights.length > 0 && (\n              <div className=\"bg-blue-50 border border-blue-200 rounded-2xl p-8\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <div>\n                    <h2 className=\"text-2xl font-bold text-slate-950 mb-1\">Analysis In Progress</h2>\n                    <p className=\"text-sm text-slate-600\">\n                      {totalProcessed}/{totalInFile} prospects loaded â€¢ {streamingProgress}% complete\n                    </p>\n                  </div>\n                  <div className=\"text-4xl font-bold text-slate-950\">{streamingProgress}%</div>\n                </div>\n                \n                <div className=\"w-full bg-slate-200 rounded-full h-3 overflow-hidden mb-6\">\n                  <div\n                    className=\"bg-blue-600 h-full transition-all duration-500\"\n                    style={{ width: `${streamingProgress}%` }}\n                  />\n                </div>\n                \n                <p className=\"text-sm text-slate-700 mb-4\">{streamingMessage}</p>\n                \n                {isStillProcessing && (\n                  <div className=\"flex items-center gap-2 text-sm text-slate-600\">\n                    <div className=\"flex gap-1\">\n                      <div className=\"w-2 h-2 bg-blue-600 rounded-full animate-bounce\" style={{ animationDelay: \"0ms\" }}></div>\n                      <div className=\"w-2 h-2 bg-blue-600 rounded-full animate-bounce\" style={{ animationDelay: \"150ms\" }}></div>\n                      <div className=\"w-2 h-2 bg-blue-600 rounded-full animate-bounce\" style={{ animationDelay: \"300ms\" }}></div>\n                    </div>\n                    <span>Processing more data...</span>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Export Available Data During Processing */}\n            {availableForExport && isStillProcessing && (\n              <div className=\"bg-amber-50 border border-amber-200 rounded-2xl p-8\">\n                <h3 className=\"text-lg font-bold text-slate-950 mb-3\">âœ“ {totalProcessed} Prospects Ready</h3>\n                <p className=\"text-slate-700 mb-4\">\n                  You can download insights for the {totalProcessed} prospects loaded so far while we continue processing the remaining {totalInFile - totalProcessed} prospects.\n                </p>\n                <div className=\"flex flex-wrap gap-3\">\n                  <button\n                    onClick={() => downloadInsights(availableForExport)}\n                    className=\"px-4 py-2 bg-amber-600 text-white font-semibold rounded-lg hover:bg-amber-700 text-sm\"\n                  >\n                    Download Available (Text)\n                  </button>\n                  <button\n                    onClick={() => downloadJSON(availableForExport)}\n                    className=\"px-4 py-2 bg-amber-600 text-white font-semibold rounded-lg hover:bg-amber-700 text-sm\"\n                  >\n                    Download Available (JSON)\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* Completion */}\n            {insights && (\n              <div className=\"bg-green-50 border border-green-200 rounded-2xl p-8\">\n                <h2 className=\"text-2xl font-bold text-slate-950 mb-4\">âœ“ Analysis Complete</h2>\n                <p className=\"text-slate-700 mb-6\">Generated insights for all {insights.prospectInsights.length} prospect{insights.prospectInsights.length !== 1 ? 's' : ''}</p>\n                <div className=\"flex flex-wrap gap-3\">\n                  <button\n                    onClick={() => downloadInsights()}\n                    className=\"px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 text-sm\"\n                  >\n                    Download Text\n                  </button>\n                  <button\n                    onClick={() => downloadJSON()}\n                    className=\"px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 text-sm\"\n                  >\n                    Download JSON\n                  </button>\n                  <button\n                    onClick={() => {\n                      setInsights(null);\n                      setStreamingInsights([]);\n                      setSelectedFile(null);\n                      setAvailableForExport(null);\n                    }}\n                    className=\"px-4 py-2 border border-slate-300 text-slate-950 font-semibold rounded-lg hover:bg-slate-50 text-sm\"\n                  >\n                    Analyze Another\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* Results */}\n            <div className=\"space-y-6\">\n              <h2 className=\"text-3xl font-bold text-slate-950\">Insights</h2>\n              {(insights?.prospectInsights || streamingInsights).map((prospect, idx) => (\n                <div \n                  key={idx}\n                  className=\"bg-white border border-slate-200 rounded-xl p-8 hover:shadow-md transition-all\"\n                >\n                  <div className=\"mb-6\">\n                    <h3 className=\"text-2xl font-bold text-slate-950\">{prospect.name}</h3>\n                    <p className=\"text-slate-600\">{prospect.role}</p>\n                  </div>\n\n                  <div className=\"mb-6 pb-6 border-b border-slate-200\">\n                    <p className=\"text-slate-700\">{prospect.profileNotes}</p>\n                  </div>\n\n                  <div className=\"mb-6\">\n                    <h4 className=\"font-semibold text-slate-950 mb-3\">Pitch Suggestions</h4>\n                    <div className=\"space-y-3\">\n                      {prospect.pitchSuggestions.map((pitch, pIdx) => (\n                        <div key={pIdx} className=\"p-3 bg-slate-50 rounded-lg text-slate-700 text-sm\">\n                          <strong className=\"text-slate-950\">{pIdx + 1}.</strong> {pitch.pitch}\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n\n                  <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                    <p className=\"text-xs font-semibold text-slate-600 uppercase mb-2\">Opening Message</p>\n                    <p className=\"italic text-slate-800\">&quot;{prospect.conversationStarter}&quot;</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Footer */}\n      <footer className=\"border-t border-slate-200 bg-white\">\n        <div className=\"max-w-6xl mx-auto px-6 lg:px-8 py-8 text-center text-sm text-slate-600\">\n          <p>&copy; 2025 Cehpoint. All rights reserved.</p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","size_bytes":18855},"app/api/analyze/route.ts":{"content":"import { NextRequest, NextResponse } from \"next/server\";\nimport { parseExcelFile, parseCSVFile, validateFileType, validateFileSize } from \"@/lib/files\";\nimport { generateClientInsights } from \"@/lib/gemini\";\nimport { ClientInsightReport, ProspectInsight, LeadRecord } from \"@/lib/types\";\n\nconst BATCH_SIZE = 5;\n\n// Helper function to augment prospect insights with company data from lead records\n// Uses index-based matching since Gemini returns prospects in the same order as input\nfunction augmentProspectsWithCompany(\n  prospects: ProspectInsight[],\n  leads: LeadRecord[]\n): ProspectInsight[] {\n  return prospects.map((prospect, index) => {\n    // Get corresponding lead by index (Gemini preserves order)\n    const correspondingLead = leads[index];\n    \n    // Always ensure company field exists, prioritizing existing data\n    const company = prospect.company || correspondingLead?.company || \"Unknown Company\";\n    \n    return {\n      ...prospect,\n      company,\n    };\n  });\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData();\n    const file = formData.get(\"file\") as File;\n\n    if (!file) {\n      return NextResponse.json(\n        { error: \"No file provided\" },\n        { status: 400 }\n      );\n    }\n\n    if (!validateFileType(file)) {\n      return NextResponse.json(\n        { error: \"Invalid file type. Please upload an Excel (.xlsx, .xls) or CSV (.csv) file.\" },\n        { status: 400 }\n      );\n    }\n\n    if (!validateFileSize(file, 10)) {\n      return NextResponse.json(\n        { error: \"File size too large. Maximum size is 10MB.\" },\n        { status: 400 }\n      );\n    }\n\n    console.log(`[Streaming Analysis] Starting file: ${file.name}`);\n\n    // Parse file\n    let leads;\n    if (file.name.toLowerCase().endsWith(\".csv\")) {\n      leads = await parseCSVFile(file);\n    } else {\n      leads = await parseExcelFile(file);\n    }\n\n    if (leads.length === 0) {\n      return NextResponse.json(\n        { error: \"No valid prospect data found in the file.\" },\n        { status: 400 }\n      );\n    }\n\n    console.log(`[Streaming Analysis] Parsed ${leads.length} valid prospects, processing in batches of ${BATCH_SIZE}`);\n\n    // Create ReadableStream for streaming responses\n    const encoder = new TextEncoder();\n    const stream = new ReadableStream({\n      async start(controller) {\n        try {\n          const allProspects: ProspectInsight[] = [];\n          const originalCount = leads.length;\n          \n          // First batch: load 15 prospects immediately\n          const INITIAL_BATCH_SIZE = 15;\n          const initialBatch = leads.slice(0, INITIAL_BATCH_SIZE);\n          const remainingLeads = leads.slice(INITIAL_BATCH_SIZE);\n\n          // Send initial status\n          controller.enqueue(\n            encoder.encode(\n              JSON.stringify({\n                type: \"status\",\n                message: `Starting analysis of ${initialBatch.length} prospect${initialBatch.length !== 1 ? 's' : ''}${remainingLeads.length > 0 ? ` (file contains ${originalCount} total, loading more in 1 minute)` : ''}`,\n                totalProspectsInFile: originalCount,\n                currentBatch: 1,\n                totalBatches: Math.ceil(originalCount / INITIAL_BATCH_SIZE),\n              }) + \"\\n\"\n            )\n          );\n\n          // Process initial batch in sub-batches\n          console.log(`[Streaming Analysis] Processing initial ${initialBatch.length} prospects in batches of ${BATCH_SIZE}`);\n          \n          for (let i = 0; i < initialBatch.length; i += BATCH_SIZE) {\n            const batch = initialBatch.slice(i, i + BATCH_SIZE);\n            const batchNumber = Math.floor(i / BATCH_SIZE) + 1;\n            const totalBatches = Math.ceil(initialBatch.length / BATCH_SIZE);\n\n            try {\n              const batchInsights = await generateClientInsights(batch);\n              \n              // Augment prospects with company data from lead records\n              const augmentedProspects = augmentProspectsWithCompany(\n                batchInsights.prospectInsights,\n                batch\n              );\n              \n              allProspects.push(...augmentedProspects);\n\n              const progress = Math.round((allProspects.length / originalCount) * 100);\n\n              // Send batch results\n              controller.enqueue(\n                encoder.encode(\n                  JSON.stringify({\n                    type: \"batch\",\n                    batchNumber,\n                    totalBatches,\n                    prospects: augmentedProspects,\n                    progress,\n                    totalProcessed: allProspects.length,\n                    totalInFile: originalCount,\n                    isProcessing: remainingLeads.length > 0,\n                  }) + \"\\n\"\n                )\n              );\n\n              if (i + BATCH_SIZE < initialBatch.length) {\n                await new Promise(resolve => setTimeout(resolve, 500));\n              }\n            } catch (batchError) {\n              const errorMsg = batchError instanceof Error ? batchError.message : 'Unknown error';\n              console.error(`[Streaming Analysis] Batch failed:`, errorMsg);\n              \n              // Send error but continue with batch processing\n              controller.enqueue(\n                encoder.encode(\n                  JSON.stringify({\n                    type: \"error\",\n                    message: `Batch processing encountered an issue: ${errorMsg}. Continuing with batch-wise analysis...`,\n                    canRetry: true,\n                  }) + \"\\n\"\n                )\n              );\n              \n              // Continue to next batch instead of stopping\n              continue;\n            }\n          }\n\n          // If there are remaining prospects, start processing them\n          if (remainingLeads.length > 0) {\n            console.log(`[Streaming Analysis] Initial batch complete. ${remainingLeads.length} prospects queued for next batch in 1 minute...`);\n            \n            // Send \"ready for export\" message\n            const framework = generateClientFramework(allProspects);\n            const exportReport: ClientInsightReport = {\n              idealClientFramework: framework,\n              prospectInsights: allProspects,\n              generatedAt: new Date().toISOString(),\n            };\n\n            controller.enqueue(\n              encoder.encode(\n                JSON.stringify({\n                  type: \"batch_complete_available\",\n                  message: `Loaded ${allProspects.length}/${originalCount} prospects. You can now export available data. Continuing to process remaining ${remainingLeads.length} prospects...`,\n                  currentReport: exportReport,\n                  totalProcessed: allProspects.length,\n                  totalInFile: originalCount,\n                  isProcessing: true,\n                }) + \"\\n\"\n              )\n            );\n\n            // Wait 1 minute before processing next batch\n            await new Promise(resolve => setTimeout(resolve, 60000));\n\n            // Process remaining prospects in batches of 15\n            const remainingBatches = Math.ceil(remainingLeads.length / INITIAL_BATCH_SIZE);\n            \n            for (let batchIdx = 0; batchIdx < remainingBatches; batchIdx++) {\n              const start = batchIdx * INITIAL_BATCH_SIZE;\n              const end = Math.min(start + INITIAL_BATCH_SIZE, remainingLeads.length);\n              const nextBatch = remainingLeads.slice(start, end);\n\n              console.log(`[Streaming Analysis] Processing batch ${batchIdx + 2}/${remainingBatches + 1}: ${nextBatch.length} prospects`);\n\n              // Process this batch in sub-batches of 5\n              for (let i = 0; i < nextBatch.length; i += BATCH_SIZE) {\n                const subBatch = nextBatch.slice(i, i + BATCH_SIZE);\n                \n                try {\n                  const batchInsights = await generateClientInsights(subBatch);\n                  \n                  // Augment prospects with company data from lead records\n                  const augmentedProspects = augmentProspectsWithCompany(\n                    batchInsights.prospectInsights,\n                    subBatch\n                  );\n                  \n                  allProspects.push(...augmentedProspects);\n\n                  const progress = Math.round((allProspects.length / originalCount) * 100);\n\n                  // Send batch results\n                  controller.enqueue(\n                    encoder.encode(\n                      JSON.stringify({\n                        type: \"batch\",\n                        prospects: augmentedProspects,\n                        progress,\n                        totalProcessed: allProspects.length,\n                        totalInFile: originalCount,\n                        isProcessing: allProspects.length < originalCount,\n                      }) + \"\\n\"\n                    )\n                  );\n\n                  await new Promise(resolve => setTimeout(resolve, 500));\n                } catch (batchError) {\n                  const errorMsg = batchError instanceof Error ? batchError.message : 'Unknown error';\n                  console.error(`[Streaming Analysis] Sub-batch failed:`, errorMsg);\n                  \n                  // Send error but continue processing\n                  controller.enqueue(\n                    encoder.encode(\n                      JSON.stringify({\n                        type: \"error\",\n                        message: `API error in processing: ${errorMsg}. Retrying batch...`,\n                        canRetry: true,\n                      }) + \"\\n\"\n                    )\n                  );\n                  \n                  // Continue with next sub-batch\n                  continue;\n                }\n              }\n\n              // After each batch group, send updated report for export\n              if (allProspects.length < originalCount) {\n                const framework = generateClientFramework(allProspects);\n                const exportReport: ClientInsightReport = {\n                  idealClientFramework: framework,\n                  prospectInsights: allProspects,\n                  generatedAt: new Date().toISOString(),\n                };\n\n                controller.enqueue(\n                  encoder.encode(\n                    JSON.stringify({\n                      type: \"batch_complete_available\",\n                      currentReport: exportReport,\n                      totalProcessed: allProspects.length,\n                      totalInFile: originalCount,\n                      isProcessing: allProspects.length < originalCount,\n                    }) + \"\\n\"\n                  )\n                );\n              }\n\n              // Wait before next batch\n              if (end < remainingLeads.length) {\n                await new Promise(resolve => setTimeout(resolve, 60000));\n              }\n            }\n          }\n\n          // Final completion\n          const finalFramework = generateClientFramework(allProspects);\n          const finalReport: ClientInsightReport = {\n            idealClientFramework: finalFramework,\n            prospectInsights: allProspects,\n            generatedAt: new Date().toISOString(),\n          };\n\n          controller.enqueue(\n            encoder.encode(\n              JSON.stringify({\n                type: \"complete\",\n                report: finalReport,\n                totalProcessed: allProspects.length,\n                message: `Analysis complete! Processed all ${allProspects.length} prospects.`,\n              }) + \"\\n\"\n            )\n          );\n\n          console.log(`[Streaming Analysis] Analysis complete: ${allProspects.length} prospects`);\n          controller.close();\n        } catch (error) {\n          console.error(\"[Streaming Analysis] Stream error:\", error);\n          controller.enqueue(\n            encoder.encode(\n              JSON.stringify({\n                type: \"error\",\n                message: error instanceof Error ? error.message : \"An unexpected error occurred\",\n              }) + \"\\n\"\n            )\n          );\n          controller.close();\n        }\n      },\n    });\n\n    return new NextResponse(stream, {\n      headers: {\n        \"Content-Type\": \"text/event-stream; charset=utf-8\",\n        \"Transfer-Encoding\": \"chunked\",\n        \"Cache-Control\": \"no-cache\",\n        \"Connection\": \"keep-alive\",\n        \"X-Accel-Buffering\": \"no\",\n      },\n    });\n  } catch (error) {\n    console.error(\"[Streaming Analysis] Request error:\", error);\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : \"An unexpected error occurred\" },\n      { status: 500 }\n    );\n  }\n}\n\nfunction generateClientFramework(prospects: ProspectInsight[]) {\n  // Analyze roles and create framework categories\n  const roleMap = new Map<string, number>();\n\n  prospects.forEach((p) => {\n    const role = p.role.split(/[,/]|and/)[0].trim().toLowerCase();\n    roleMap.set(role, (roleMap.get(role) || 0) + 1);\n  });\n\n  // Create categories from top roles\n  const categories = Array.from(roleMap.entries())\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 3)\n    .map(([role]) => ({\n      category: `${role.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')} Decision Makers`,\n      description: `Professionals in ${role} roles typically manage technology, security, and business development initiatives`,\n      needs: [\n        \"Secure, scalable technology solutions\",\n        \"Risk mitigation and compliance\",\n        \"Team augmentation and expertise\",\n      ],\n    }));\n\n  return categories.length > 0\n    ? categories\n    : [\n        {\n          category: \"Technology Leaders\",\n          description: \"Executives responsible for technology strategy and implementation\",\n          needs: [\"Secure, scalable solutions\", \"Risk mitigation\", \"Team augmentation\"],\n        },\n      ];\n}\n","size_bytes":13893},"lib/gemini.ts":{"content":"import { LeadRecord, ClientInsightReport } from \"./types\";\nimport { geminiClient } from \"./gemini-client\";\nimport { RateLimitError } from \"./errors\";\nimport { sleep } from \"./retry\";\n\nconst MAX_RATE_LIMIT_RETRIES = 10;\n\nexport async function generateClientInsights(\n  leads: LeadRecord[]\n): Promise<ClientInsightReport> {\n  const systemPrompt = `You are an elite B2B sales strategist specializing in enterprise software development, infrastructure solutions, and cybersecurity. Your role is to analyze prospect profiles and generate deeply personalized, highly specific sales intelligence that converts conversations into partnerships.\n\nCEHPOINT - PREMIUM SERVICES FIRM:\nWe deliver enterprise-scale solutions:\n- Custom software development & architecture modernization\n- Security implementation: HIPAA, SOC2, PCI-DSS, ISO 27001 compliance\n- Infrastructure optimization: Cloud, DevSecOps, CI/CD automation\n- AI/ML integration & technical innovation\n- Overflow engineering capacity & dedicated technical teams\n- Security audits, architecture reviews, penetration testing\n\nIDEAL CLIENT FRAMEWORK - EXACT BUYER PERSONAS:\n\nA. FOUNDERS / CO-FOUNDERS (Tech Companies)\n   Profile: Building MVP or scaling product, managing technical debt, scaling teams\n   Critical Pain: Engineering bottlenecks, security gaps, rapid shipping needs, compliance\n   Value Play: \"Let us handle the complexity - you focus on product growth\"\n\nB. CTOs / VP ENGINEERING (Enterprise Tech Leaders)\n   Profile: Own tech stack, security gate-keeper, growth through engineering excellence  \n   Critical Pain: Team bandwidth, technical debt, DevSecOps maturity, security posture\n   Value Play: \"Extend your team with vetted specialists for strategic initiatives\"\n\nC. CEOs / FOUNDERS (IT Services/Dev Shops)\n   Profile: Running service delivery, client expectations rising, profit margin pressure\n   Critical Pain: Overflow capacity, white-label solutions, security certifications, delivery speed\n   Value Play: \"Scale delivery without scaling headcount or risk\"\n\nD. INFRASTRUCTURE ARCHITECTS / CLOUD LEADS\n   Profile: Infrastructure-first thinking, DevOps focus, cost optimization, security\n   Critical Pain: Cost overruns, team expertise gaps, deployment complexity, compliance\n   Value Play: \"Optimize costs and security while reducing operational burden\"\n\nPROSPECT ANALYSIS (For EACH prospect, MUST deliver):\n\n1. PROFILE NOTES (2-3 laser-focused sentences):\n   MUST reference: their specific role title, likely company stage, technical challenges\n   MUST connect: to one of the 4 buyer personas\n   MUST imply: why Cehpoint specifically solves their problem\n   AVOID: generic observations, vague language\n\n2. THREE DIFFERENTIATED PITCHES (1-2 sentences each):\n   Pitch 1: Address their #1 business pressure (urgency-focused)\n   Pitch 2: Address secondary strategic need (growth-focused)\n   Pitch 3: Position unique partnership advantage (outcome-focused)\n   CRITICAL: Each pitch must be completely different, not variations\n   CRITICAL: Use outcome language (speed to market, security posture, team capacity, ROI)\n   CRITICAL: Never say \"services\" or \"solutions\" - say what problem gets solved\n\n3. CONVERSATION STARTER (2-3 sentences):\n   MUST: Show concrete understanding of their role/company context\n   MUST: Reference something specific about their likely situation\n   MUST: Position Cehpoint as strategic problem-solver, not vendor\n   MUST: End with open question that invites discussion\n   Example: \"Sarah, your role as CTO at a Series B fintech means security audits are non-negotiable. Many founders in your position partner with us to offload security reviews while scaling engineering. Can we explore how this could work for your roadmap?\"\n\nFRAMEWORK CLASSIFICATION (Look at prospects, determine categories present):\n- ONLY include frameworks that are actually represented in the data\n- Extract 3 specific pain points for each represented category\n- Use buyer personas as classification reference\n\nOUTPUT - STRICT VALID JSON ONLY (no markdown, no commentary):\n{\n  \"idealClientFramework\": [\n    {\n      \"category\": \"Exact category name (e.g., 'Founders / Co-Founders of Scaling Tech Companies')\",\n      \"description\": \"What defines this prospect type and their primary business challenges\",\n      \"needs\": [\"Specific need 1\", \"Specific need 2\", \"Specific need 3\"]\n    }\n  ],\n  \"prospectInsights\": [\n    {\n      \"name\": \"Full name exactly as provided\",\n      \"role\": \"Their exact role/title\",\n      \"company\": \"Their exact company name\",\n      \"location\": \"Their location if provided (optional)\",\n      \"description\": \"Their description if provided (optional)\",\n      \"profileNotes\": \"2-3 sentences: role context + company stage + technical challenge + Cehpoint alignment\",\n      \"pitchSuggestions\": [\n        {\"pitch\": \"Pitch 1 - their most urgent problem\"},\n        {\"pitch\": \"Pitch 2 - secondary strategic benefit\"},\n        {\"pitch\": \"Pitch 3 - unique partnership/competitive advantage\"}\n      ],\n      \"conversationStarter\": \"Personalized opening showing understanding + specific context + question\"\n    }\n  ],\n  \"generatedAt\": \"ISO timestamp\"\n}\n\nQUALITY CHECKLIST:\nâœ“ Every statement is specific to prospect (no generic phrases)\nâœ“ Pitches address actual business outcomes (not features)\nâœ“ Pitches are clearly differentiated (not similar)\nâœ“ Profile notes reference their role and likely stage\nâœ“ Conversation starters show real understanding (not generic opener)\nâœ“ All language is professional B2B (never mention AI, tools, or process)\nâœ“ Framework only includes categories actually present in data\nâœ“ No fluff, no selling language - pure insight and business value`;\n\n  const userPrompt = `Analyze these ${leads.length} prospect(s) and generate strategic sales insights.\n\nPROSPECT DATA:\n${JSON.stringify(leads, null, 2)}\n\nCRITICAL REQUIREMENTS:\n1. Respond ONLY with valid JSON - no markdown, no extra text\n2. Each prospect gets exactly 3 unique, targeted pitches\n3. All text must be professional and sales-ready\n4. Profile notes must reference specific aspects of their role/company\n5. Conversation starters must be personalized and specific\n6. Include 2-4 ideal client framework categories based on the prospects provided`;\n\n  console.log(`[Gemini API] Analyzing ${leads.length} prospect(s)...`);\n  \n  for (let rateLimitRetry = 0; rateLimitRetry < MAX_RATE_LIMIT_RETRIES; rateLimitRetry++) {\n    try {\n      const rawJson = await geminiClient.callWithRetry({\n        model: \"gemini-2.5-flash\",\n        systemInstruction: systemPrompt,\n        userPrompt,\n        temperature: 0.7,\n        responseMimeType: \"application/json\",\n      }, (telemetry) => {\n        console.log(`[Gemini API] Retry attempt ${telemetry.attempt}/${telemetry.maxAttempts} after ${(telemetry.delay / 1000).toFixed(1)}s (key: ${telemetry.keyUsed}, error: ${telemetry.error.message})`);\n      });\n      \n      console.log(\"[Gemini API] Parsing JSON response...\");\n      \n      const insights: ClientInsightReport = JSON.parse(rawJson);\n      insights.generatedAt = new Date().toISOString();\n      \n      console.log(`[Gemini API] âœ“ Successfully generated insights for ${insights.prospectInsights.length} prospect(s)`);\n      return insights;\n    } catch (error) {\n      if (error instanceof RateLimitError) {\n        const waitTime = (error.retryAfter || 60) * 1000;\n        console.log(`[Gemini API] All keys on cooldown. Waiting ${error.retryAfter || 60}s before retry (attempt ${rateLimitRetry + 1}/${MAX_RATE_LIMIT_RETRIES})...`);\n        await sleep(waitTime);\n        continue;\n      }\n      \n      throw error;\n    }\n  }\n  \n  throw new Error(`Failed to generate insights after ${MAX_RATE_LIMIT_RETRIES} rate limit retries`);\n}\n","size_bytes":7699},"app/components/Logo.tsx":{"content":"export default function Logo({ className = \"\" }: { className?: string }) {\n  return (\n    <div className={`flex items-center gap-2.5 ${className}`}>\n      <div className=\"w-8 h-8 bg-gray-900 rounded-lg flex items-center justify-center\">\n        <span className=\"text-sm font-bold text-white\">C</span>\n      </div>\n      <div className=\"flex flex-col\">\n        <span className=\"text-base font-semibold text-gray-900\">\n          Cehpoint\n        </span>\n        <span className=\"text-xs text-gray-500\">\n          Client Insights\n        </span>\n      </div>\n    </div>\n  );\n}\n","size_bytes":574},"app/page.tsx":{"content":"\"use client\";\n\nimport { useState, useRef } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { ClientInsightReport, ProspectInsight } from \"@/lib/types\";\nimport Logo from \"./components/Logo\";\nimport RegeneratePitchModal from \"./components/RegeneratePitchModal\";\nimport ExpandPitchModal from \"./components/ExpandPitchModal\";\n\ninterface BatchUpdate {\n  type: string;\n  batchNumber?: number;\n  totalBatches?: number;\n  batches?: number;\n  prospects?: ProspectInsight[];\n  progress?: number;\n  message?: string;\n  report?: ClientInsightReport;\n  currentReport?: ClientInsightReport;\n  totalProcessed?: number;\n  totalInFile?: number;\n  isProcessing?: boolean;\n  canRetry?: boolean;\n}\n\nexport default function HomePage() {\n  const [isPending, setIsPending] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [insights, setInsights] = useState<ClientInsightReport | null>(null);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [streamingInsights, setStreamingInsights] = useState<ProspectInsight[]>([]);\n  const [streamingProgress, setStreamingProgress] = useState(0);\n  const [streamingMessage, setStreamingMessage] = useState(\"\");\n  const [totalInFile, setTotalInFile] = useState(0);\n  const [totalProcessed, setTotalProcessed] = useState(0);\n  const [availableForExport, setAvailableForExport] = useState<ClientInsightReport | null>(null);\n  const [isStillProcessing, setIsStillProcessing] = useState(false);\n  const [apiError, setApiError] = useState<string | null>(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [copiedPitch, setCopiedPitch] = useState<string | null>(null);\n  const [modalOpen, setModalOpen] = useState(false);\n  const [selectedProspectForRegeneration, setSelectedProspectForRegeneration] = useState<{ prospect: ProspectInsight; index: number } | null>(null);\n  const [expandModalOpen, setExpandModalOpen] = useState(false);\n  const [selectedPitchForExpansion, setSelectedPitchForExpansion] = useState<{ prospect: ProspectInsight; pitch: string } | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      setSelectedFile(file);\n      setError(null);\n      setApiError(null);\n    }\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n    \n    const file = e.dataTransfer.files[0];\n    if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls') || file.name.endsWith('.csv'))) {\n      setSelectedFile(file);\n      setError(null);\n      setApiError(null);\n      \n      if (fileInputRef.current) {\n        const dataTransfer = new DataTransfer();\n        dataTransfer.items.add(file);\n        fileInputRef.current.files = dataTransfer.files;\n      }\n    } else {\n      setError('Please upload a valid Excel (.xlsx, .xls) or CSV file');\n    }\n  };\n\n  const copyToClipboard = async (text: string, id: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopiedPitch(id);\n      setTimeout(() => setCopiedPitch(null), 2000);\n    } catch (err) {\n      console.error('Failed to copy:', err);\n    }\n  };\n\n  const openRegenerateModal = (prospect: ProspectInsight, index: number) => {\n    setSelectedProspectForRegeneration({ prospect, index });\n    setModalOpen(true);\n  };\n\n  const closeRegenerateModal = () => {\n    setModalOpen(false);\n    setSelectedProspectForRegeneration(null);\n  };\n\n  const openExpandModal = (prospect: ProspectInsight, pitch: string) => {\n    setSelectedPitchForExpansion({ prospect, pitch });\n    setExpandModalOpen(true);\n  };\n\n  const closeExpandModal = () => {\n    setExpandModalOpen(false);\n    setSelectedPitchForExpansion(null);\n  };\n\n  const handleProspectUpdate = (updatedProspect: ProspectInsight) => {\n    if (!selectedProspectForRegeneration) return;\n    \n    const index = selectedProspectForRegeneration.index;\n\n    // Update the prospect in both insights and streaming insights\n    if (insights) {\n      const updatedInsights = { ...insights };\n      updatedInsights.prospectInsights[index] = updatedProspect;\n      setInsights(updatedInsights);\n    }\n\n    if (streamingInsights.length > 0) {\n      const updatedStreamingInsights = [...streamingInsights];\n      updatedStreamingInsights[index] = updatedProspect;\n      setStreamingInsights(updatedStreamingInsights);\n    }\n  };\n\n  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    setIsPending(true);\n    setError(null);\n    setApiError(null);\n    setStreamingInsights([]);\n    setStreamingProgress(0);\n    setStreamingMessage(\"\");\n    setTotalInFile(0);\n    setTotalProcessed(0);\n    setAvailableForExport(null);\n    setIsStillProcessing(false);\n\n    const formData = new FormData(event.currentTarget);\n\n    try {\n      const response = await fetch(\"/api/analyze\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to analyze file\");\n      }\n\n      const reader = response.body?.getReader();\n      if (!reader) throw new Error(\"No response body\");\n\n      const decoder = new TextDecoder();\n      let buffer = \"\";\n      let hasReceivedData = false;\n\n      const timeout = setTimeout(() => {\n        if (!hasReceivedData) {\n          setApiError(\"API Response Delayed: Analyzing prospects in batches. You can download partial results.\");\n        }\n      }, 5000);\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        hasReceivedData = true;\n        clearTimeout(timeout);\n        setApiError(null);\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split(\"\\n\");\n        buffer = lines.pop() || \"\";\n\n        for (const line of lines) {\n          if (!line.trim()) continue;\n\n          try {\n            const update: BatchUpdate = JSON.parse(line);\n\n            if (update.type === \"status\") {\n              setStreamingMessage(update.message || \"Starting analysis...\");\n              setTotalInFile(update.totalInFile || 0);\n            }\n\n            if (update.type === \"batch\" && update.prospects) {\n              setStreamingInsights(prev => [...prev, ...update.prospects!]);\n              const processed = update.totalProcessed || 0;\n              const total = update.totalInFile || 0;\n              setTotalProcessed(processed);\n              setTotalInFile(total);\n              const progressPercent = total \n                ? Math.round((processed / total) * 100) \n                : 0;\n              setStreamingProgress(progressPercent);\n              setIsStillProcessing(update.isProcessing === true);\n            }\n\n            if (update.type === \"batch_complete_available\" && update.currentReport) {\n              setAvailableForExport(update.currentReport);\n              const processed = update.totalProcessed || 0;\n              const total = update.totalInFile || 0;\n              setTotalProcessed(processed);\n              setTotalInFile(total);\n              setStreamingMessage(update.message || \"Processing more data...\");\n              setIsStillProcessing(update.isProcessing === true);\n              const progressPercent = total \n                ? Math.round((processed / total) * 100) \n                : 0;\n              setStreamingProgress(progressPercent);\n            }\n\n            if (update.type === \"complete\" && update.report) {\n              setInsights(update.report);\n              setStreamingProgress(100);\n              setStreamingMessage(\"Analysis complete\");\n              setIsStillProcessing(false);\n              setIsPending(false);\n            }\n\n            if (update.type === \"error\") {\n              console.error(\"API Error:\", update.message);\n              setApiError(`${update.message}. System will continue batch-wise processing.`);\n              setIsStillProcessing(true);\n            }\n          } catch {\n            // Continue parsing\n          }\n        }\n      }\n\n      clearTimeout(timeout);\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : \"An error occurred\";\n      setError(errorMsg);\n      setApiError(`Connection Issue: ${errorMsg}. You can download any partial results.`);\n      setIsPending(false);\n    }\n  };\n\n  const downloadInsights = (report: ClientInsightReport | null = null) => {\n    const dataToExport = report || insights;\n    if (!dataToExport) return;\n    \n    const text = dataToExport.prospectInsights\n      .map(p => `${p.name} (${p.role})\\n${p.profileNotes}\\n\\nPitches:\\n${p.pitchSuggestions.map((s, i) => `${i + 1}. ${s.pitch}`).join(\"\\n\")}\\n\\nOpening:\\n\"${p.conversationStarter}\"\\n`)\n      .join(\"\\n---\\n\");\n    \n    const blob = new Blob([text], { type: \"text/plain\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `cehpoint-insights-${new Date().toISOString().split(\"T\")[0]}.txt`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  const downloadJSON = (report: ClientInsightReport | null = null) => {\n    const dataToExport = report || insights;\n    if (!dataToExport) return;\n    \n    const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: \"application/json\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `cehpoint-insights-${new Date().toISOString().split(\"T\")[0]}.json`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-white\">\n      {/* Navigation */}\n      <nav className=\"border-b border-gray-200 bg-white\">\n        <div className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between\">\n          <Logo />\n          <div className=\"flex items-center gap-2\">\n            <div className=\"h-1.5 w-1.5 bg-emerald-500 rounded-full\" />\n            <span className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">\n              Live\n            </span>\n          </div>\n        </div>\n      </nav>\n\n      {/* Main Content */}\n      <div className=\"flex-1 max-w-5xl mx-auto w-full py-8 sm:py-16 px-4 sm:px-6 lg:px-8\">\n        <AnimatePresence mode=\"wait\">\n          {!insights && streamingInsights.length === 0 ? (\n            <motion.div \n              key=\"upload\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"space-y-10\"\n            >\n              {/* Header */}\n              <div className=\"space-y-3\">\n                <h1 className=\"text-4xl sm:text-5xl font-semibold text-gray-900 tracking-tight\">\n                  Prospect Intelligence\n                </h1>\n                <p className=\"text-lg text-gray-600 max-w-2xl\">\n                  Upload your prospect data to generate personalized sales insights and pitches powered by AI\n                </p>\n              </div>\n\n              {/* Upload Form */}\n              <div className=\"bg-white border border-gray-200 rounded-lg p-6 sm:p-8\">\n                <form onSubmit={handleSubmit} className=\"space-y-6\">\n                  {/* File Upload */}\n                  <div className=\"space-y-4\">\n                    <label className=\"block text-sm font-medium text-gray-900\">\n                      Upload File\n                    </label>\n\n                    <input\n                      ref={fileInputRef}\n                      type=\"file\"\n                      id=\"file\"\n                      name=\"file\"\n                      accept=\".xlsx,.xls,.csv\"\n                      required\n                      disabled={isPending}\n                      onChange={handleFileChange}\n                      className=\"hidden\"\n                    />\n                    \n                    <label\n                      htmlFor=\"file\"\n                      onDragOver={handleDragOver}\n                      onDragLeave={handleDragLeave}\n                      onDrop={handleDrop}\n                      className={`relative flex flex-col items-center justify-center w-full px-6 py-10 border-2 border-dashed rounded-lg cursor-pointer transition-colors ${\n                        isDragging\n                          ? \"border-blue-500 bg-blue-50\"\n                          : selectedFile\n                          ? \"border-emerald-500 bg-emerald-50\"\n                          : \"border-gray-300 hover:border-gray-400 bg-gray-50\"\n                      }`}\n                    >\n                      <svg className={`w-10 h-10 mb-3 ${selectedFile ? 'text-emerald-600' : 'text-gray-400'}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\n                      </svg>\n                      \n                      {selectedFile ? (\n                        <div className=\"text-center\">\n                          <p className=\"font-medium text-gray-900\">{selectedFile.name}</p>\n                          <p className=\"text-sm text-gray-500 mt-1\">\n                            {(selectedFile.size / 1024).toFixed(1)} KB\n                          </p>\n                        </div>\n                      ) : (\n                        <div className=\"text-center\">\n                          <p className=\"font-medium text-gray-700\">\n                            {isDragging ? \"Drop file here\" : \"Click to upload or drag and drop\"}\n                          </p>\n                          <p className=\"text-sm text-gray-500 mt-1\">Excel or CSV â€¢ Max 10 MB</p>\n                        </div>\n                      )}\n                    </label>\n                  </div>\n\n                  {/* Required Columns */}\n                  <div className=\"space-y-3\">\n                    <label className=\"block text-sm font-medium text-gray-900\">\n                      Required Columns\n                    </label>\n                    \n                    <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\n                      {[\n                        { col: \"Name\", options: [\"name\", \"full_name\"] },\n                        { col: \"Role\", options: [\"role\", \"title\"] },\n                        { col: \"Company\", options: [\"company\", \"org\"] }\n                      ].map((req, idx) => (\n                        <div\n                          key={idx}\n                          className=\"p-3 bg-gray-50 border border-gray-200 rounded-lg\"\n                        >\n                          <p className=\"font-medium text-gray-900 text-sm mb-2\">{req.col}</p>\n                          <div className=\"space-y-1.5\">\n                            {req.options.map((opt, i) => (\n                              <div key={i}>\n                                <code className=\"block px-2 py-1 bg-white border border-gray-200 rounded text-xs text-gray-700 font-mono\">\n                                  {opt}\n                                </code>\n                                {i === 0 && <p className=\"text-center text-xs text-gray-400 py-0.5\">or</p>}\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n\n                    <p className=\"text-xs text-gray-500\">\n                      Optional: location, description, profile\n                    </p>\n                  </div>\n\n                  {/* Error */}\n                  {error && (\n                    <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n                      <p className=\"text-sm text-red-700\">{error}</p>\n                    </div>\n                  )}\n\n                  {/* Submit Button */}\n                  <button\n                    type=\"submit\"\n                    disabled={isPending || !selectedFile}\n                    className=\"w-full px-4 py-3 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                  >\n                    {isPending ? (\n                      <span className=\"flex items-center justify-center gap-2\">\n                        <svg className=\"animate-spin h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\">\n                          <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                          <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                        </svg>\n                        Analyzing...\n                      </span>\n                    ) : (\n                      \"Analyze Prospects\"\n                    )}\n                  </button>\n                </form>\n              </div>\n            </motion.div>\n          ) : (\n            <motion.div \n              key=\"results\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"space-y-6\"\n            >\n              {/* API Error */}\n              {apiError && (\n                <div className=\"p-3 bg-amber-50 border border-amber-200 rounded-lg\">\n                  <p className=\"text-sm text-amber-800\">{apiError}</p>\n                </div>\n              )}\n\n              {/* Progress */}\n              {!insights && streamingInsights.length > 0 && (\n                <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <div>\n                      <h2 className=\"text-lg font-semibold text-gray-900\">\n                        Analyzing Prospects\n                      </h2>\n                      <p className=\"text-sm text-gray-600 mt-1\">\n                        {totalProcessed} of {totalInFile} prospects â€¢ {streamingProgress}%\n                      </p>\n                    </div>\n                    <div className=\"text-2xl font-semibold text-gray-900\">\n                      {streamingProgress}%\n                    </div>\n                  </div>\n                  \n                  <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                    <div\n                      className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n                      style={{ width: `${streamingProgress}%` }}\n                    />\n                  </div>\n                  \n                  <p className=\"text-sm text-gray-600 mt-3\">{streamingMessage}</p>\n                </div>\n              )}\n\n              {/* Export Available */}\n              {availableForExport && isStillProcessing && (\n                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-6\">\n                  <h3 className=\"text-base font-semibold text-gray-900 mb-2\">\n                    {totalProcessed} Prospects Ready\n                  </h3>\n                  <p className=\"text-sm text-gray-700 mb-4\">\n                    Download insights while we continue processing the remaining {totalInFile - totalProcessed} prospects.\n                  </p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    <button\n                      onClick={() => downloadInsights(availableForExport)}\n                      className=\"px-4 py-2 bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-amber-700\"\n                    >\n                      Download Text\n                    </button>\n                    <button\n                      onClick={() => downloadJSON(availableForExport)}\n                      className=\"px-4 py-2 bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-amber-700\"\n                    >\n                      Download JSON\n                    </button>\n                  </div>\n                </div>\n              )}\n\n              {/* Completion */}\n              {insights && (\n                <div className=\"bg-emerald-50 border border-emerald-200 rounded-lg p-6\">\n                  <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                    Analysis Complete\n                  </h2>\n                  <p className=\"text-sm text-gray-700 mb-4\">\n                    Generated insights for {insights.prospectInsights.length} prospect{insights.prospectInsights.length !== 1 ? 's' : ''}\n                  </p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    <button\n                      onClick={() => downloadInsights()}\n                      className=\"px-4 py-2 bg-emerald-600 text-white text-sm font-medium rounded-lg hover:bg-emerald-700\"\n                    >\n                      Download Text\n                    </button>\n                    <button\n                      onClick={() => downloadJSON()}\n                      className=\"px-4 py-2 bg-emerald-600 text-white text-sm font-medium rounded-lg hover:bg-emerald-700\"\n                    >\n                      Download JSON\n                    </button>\n                    <button\n                      onClick={() => {\n                        setInsights(null);\n                        setStreamingInsights([]);\n                        setSelectedFile(null);\n                        setAvailableForExport(null);\n                        setApiError(null);\n                      }}\n                      className=\"px-4 py-2 border border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50\"\n                    >\n                      New Analysis\n                    </button>\n                  </div>\n                </div>\n              )}\n\n              {/* Results */}\n              <div className=\"space-y-4\">\n                <h2 className=\"text-2xl font-semibold text-gray-900\">\n                  Insights\n                </h2>\n                {(insights?.prospectInsights || streamingInsights).map((prospect, idx) => (\n                  <div \n                    key={idx}\n                    className=\"bg-white border border-gray-200 rounded-lg p-6 hover:border-gray-300 transition-colors\"\n                  >\n                    {/* Header */}\n                    <div className=\"mb-5 pb-5 border-b border-gray-200\">\n                      <h3 className=\"text-xl font-semibold text-gray-900 mb-1\">\n                        {prospect.name}\n                      </h3>\n                      <p className=\"text-sm text-gray-600\">{prospect.role}</p>\n                      <p className=\"text-sm text-gray-500 mt-0.5\">{prospect.company}</p>\n                    </div>\n\n                    {/* Profile Notes */}\n                    <div className=\"mb-5\">\n                      <p className=\"text-sm text-gray-700 leading-relaxed\">{prospect.profileNotes}</p>\n                    </div>\n\n                    {/* Pitch Suggestions */}\n                    <div className=\"mb-5\">\n                      <div className=\"flex items-center justify-between mb-3\">\n                        <h4 className=\"text-sm font-semibold text-gray-900\">\n                          Pitch Suggestions\n                        </h4>\n                        <button\n                          onClick={() => openRegenerateModal(prospect, idx)}\n                          className=\"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-blue-600 border border-blue-200 rounded-lg hover:bg-blue-50 transition-colors\"\n                          title=\"Generate new pitch variations\"\n                        >\n                          <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                          </svg>\n                          <span>Regenerate</span>\n                        </button>\n                      </div>\n                      <div className=\"space-y-2\">\n                        {prospect.pitchSuggestions.map((pitch, pIdx) => {\n                          const pitchId = `${idx}-${pIdx}`;\n                          const isCopied = copiedPitch === pitchId;\n                          \n                          return (\n                            <div\n                              key={pIdx}\n                              className=\"group relative p-3 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 transition-colors\"\n                            >\n                              <div className=\"flex gap-2 pr-20\">\n                                <span className=\"text-sm font-medium text-gray-500 flex-shrink-0\">{pIdx + 1}.</span>\n                                <p className=\"text-sm text-gray-700\">{pitch.pitch}</p>\n                              </div>\n                              <div className=\"absolute top-2 right-2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                <button\n                                  onClick={() => openExpandModal(prospect, pitch.pitch)}\n                                  className=\"px-2 py-1 text-xs font-medium text-blue-600 bg-white border border-blue-200 rounded hover:bg-blue-50 transition-colors\"\n                                  title=\"Generate full pitch\"\n                                >\n                                  Expand\n                                </button>\n                                <button\n                                  onClick={() => copyToClipboard(pitch.pitch, pitchId)}\n                                  className=\"p-1.5 hover:bg-white rounded transition-all\"\n                                  title=\"Copy\"\n                                >\n                                  {isCopied ? (\n                                    <svg className=\"w-4 h-4 text-emerald-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                      <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                                    </svg>\n                                  ) : (\n                                    <svg className=\"w-4 h-4 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\" />\n                                    </svg>\n                                  )}\n                                </button>\n                              </div>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    </div>\n\n                    {/* Conversation Starter */}\n                    <div className=\"group relative bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                      <p className=\"text-xs font-semibold text-blue-900 uppercase tracking-wide mb-2\">\n                        Opening Message\n                      </p>\n                      <p className=\"text-sm text-gray-800 italic pr-8\">&quot;{prospect.conversationStarter}&quot;</p>\n                      <button\n                        onClick={() => copyToClipboard(prospect.conversationStarter, `opener-${idx}`)}\n                        className=\"absolute top-3 right-3 p-1.5 opacity-0 group-hover:opacity-100 hover:bg-white rounded transition-all\"\n                        title=\"Copy\"\n                      >\n                        {copiedPitch === `opener-${idx}` ? (\n                          <svg className=\"w-4 h-4 text-emerald-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                          </svg>\n                        ) : (\n                          <svg className=\"w-4 h-4 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\" />\n                          </svg>\n                        )}\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n\n      {/* Footer */}\n      <footer className=\"border-t border-gray-200 bg-white\">\n        <div className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <p className=\"text-xs text-gray-500 text-center\">\n            Â© 2025 Cehpoint. All rights reserved.\n          </p>\n        </div>\n      </footer>\n\n      {/* Regenerate Pitch Modal */}\n      {selectedProspectForRegeneration && (\n        <RegeneratePitchModal\n          isOpen={modalOpen}\n          onClose={closeRegenerateModal}\n          prospect={selectedProspectForRegeneration.prospect}\n          onRegenerate={handleProspectUpdate}\n        />\n      )}\n\n      {/* Expand Pitch Modal */}\n      {selectedPitchForExpansion && (\n        <ExpandPitchModal\n          isOpen={expandModalOpen}\n          onClose={closeExpandModal}\n          prospect={selectedPitchForExpansion.prospect}\n          shortPitch={selectedPitchForExpansion.pitch}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":30318},"app/upload/actions.ts":{"content":"\"use server\";\n\nimport { parseExcelFile, parseCSVFile, validateFileType, validateFileSize } from \"@/lib/files\";\nimport { generateClientInsights } from \"@/lib/gemini\";\nimport { ClientInsightReport } from \"@/lib/types\";\n\nexport interface UploadResult {\n  success: boolean;\n  message?: string;\n  insights?: ClientInsightReport;\n  error?: string;\n  prospectCount?: number;\n  wasTruncated?: boolean;\n}\n\nconst MAX_PROSPECTS_PER_FILE = 15;\n\nexport async function processLeadFile(\n  formData: FormData\n): Promise<UploadResult> {\n  try {\n    const file = formData.get(\"file\") as File;\n\n    if (!file) {\n      return {\n        success: false,\n        error: \"No file provided\",\n      };\n    }\n\n    if (!validateFileType(file)) {\n      return {\n        success: false,\n        error: \"Invalid file type. Please upload an Excel (.xlsx, .xls) or CSV (.csv) file.\",\n      };\n    }\n\n    if (!validateFileSize(file, 10)) {\n      return {\n        success: false,\n        error: \"File size too large. Maximum size is 10MB.\",\n      };\n    }\n\n    console.log(`[File Processing] Starting analysis of ${file.name}`);\n\n    let leads;\n    if (file.name.toLowerCase().endsWith(\".csv\")) {\n      leads = await parseCSVFile(file);\n    } else {\n      leads = await parseExcelFile(file);\n    }\n\n    if (leads.length === 0) {\n      return {\n        success: false,\n        error: \"No valid prospect data found in the file. Please ensure your file has columns for name, role, and company.\",\n      };\n    }\n\n    const wasTruncated = leads.length > MAX_PROSPECTS_PER_FILE;\n    const prospectCount = leads.length;\n    \n    if (wasTruncated) {\n      console.log(`[File Processing] File contains ${prospectCount} prospects. Processing first ${MAX_PROSPECTS_PER_FILE}...`);\n    } else {\n      console.log(`[File Processing] Processing ${prospectCount} prospect(s)`);\n    }\n\n    const insights = await generateClientInsights(leads);\n\n    let message = `Successfully analyzed ${insights.prospectInsights.length} prospect(s)`;\n    if (wasTruncated) {\n      message += ` (file contained ${prospectCount} prospects, processed first ${MAX_PROSPECTS_PER_FILE})`;\n    }\n\n    return {\n      success: true,\n      message,\n      insights,\n      prospectCount,\n      wasTruncated,\n    };\n  } catch (error) {\n    console.error(\"[File Processing Error]:\", error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"An unexpected error occurred while analyzing your file\",\n    };\n  }\n}\n","size_bytes":2471},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nconst config: Config = {\n  content: [\n    \"./app/**/*.{js,ts,jsx,tsx,mdx}\",\n    \"./pages/**/*.{js,ts,jsx,tsx,mdx}\",\n    \"./components/**/*.{js,ts,jsx,tsx,mdx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        primary: \"#0C1A3D\",\n        secondary: \"#2D65FF\",\n        accent: \"#7BA7FF\",\n      },\n      spacing: {\n        0: \"0\",\n        1: \"0.125rem\",\n        2: \"0.25rem\",\n        3: \"0.375rem\",\n        4: \"0.5rem\",\n        6: \"0.75rem\",\n        8: \"1rem\",\n        12: \"1.5rem\",\n        16: \"2rem\",\n        20: \"2.5rem\",\n        24: \"3rem\",\n        32: \"4rem\",\n        40: \"5rem\",\n        48: \"6rem\",\n        56: \"7rem\",\n        64: \"8rem\",\n        72: \"9rem\",\n        80: \"10rem\",\n        96: \"12rem\",\n        120: \"15rem\",\n      },\n      fontFamily: {\n        sans: [\"Inter\", \"-apple-system\", \"BlinkMacSystemFont\", '\"Segoe UI\"', \"Roboto\", '\"Helvetica Neue\"', \"Arial\", \"sans-serif\"],\n      },\n      boxShadow: {\n        sm: \"0 4px 16px rgba(0, 0, 0, 0.06)\",\n        md: \"0 8px 24px rgba(0, 0, 0, 0.12)\",\n      },\n      animation: {\n        \"gradient-shift\": \"gradient-shift 8s ease infinite\",\n      },\n      keyframes: {\n        \"gradient-shift\": {\n          \"0%, 100%\": { \"background-position\": \"0% 50%\" },\n          \"50%\": { \"background-position\": \"100% 50%\" },\n        },\n      },\n    },\n  },\n  darkMode: \"class\",\n  plugins: [],\n};\n\nexport default config;\n","size_bytes":1493},"app/api/regenerate-pitch/route.ts":{"content":"import { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\nimport { geminiClient } from \"@/lib/gemini-client\";\nimport { RateLimitError, ValidationError as CustomValidationError } from \"@/lib/errors\";\nimport { sleep } from \"@/lib/retry\";\n\nconst MAX_RATE_LIMIT_RETRIES = 10;\n\nconst ProspectSchema = z.object({\n  name: z.string(),\n  role: z.string(),\n  company: z.string(),\n  location: z.string().optional(),\n  description: z.string().optional(),\n  profile: z.string().optional(),\n});\n\nconst PitchSuggestionSchema = z.object({\n  pitch: z.string(),\n  reasoning: z.string().optional(),\n});\n\nconst ProspectInsightSchema = z.object({\n  name: z.string(),\n  role: z.string(),\n  company: z.string(),\n  location: z.string().optional(),\n  description: z.string().optional(),\n  profileNotes: z.string(),\n  pitchSuggestions: z.array(PitchSuggestionSchema).length(3),\n  conversationStarter: z.string(),\n});\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const prospect = ProspectSchema.parse(body);\n\n\n    const systemPrompt = `You are an expert B2B sales strategist specializing in personalized outreach for Cehpoint's services.\n\nCEHPOINT - PREMIUM SERVICES FIRM:\nWe deliver enterprise-scale solutions:\n- Custom software development & architecture modernization\n- Security implementation: HIPAA, SOC2, PCI-DSS, ISO 27001 compliance\n- Infrastructure optimization: Cloud, DevSecOps, CI/CD automation\n- AI/ML integration & technical innovation\n- Overflow engineering capacity & dedicated technical teams\n- Security audits, architecture reviews, penetration testing\n\nIDEAL CLIENT FRAMEWORK:\n1. Startup Founders/CEOs - Need: Speed, reliability, cost control\n2. CTOs/VPs Engineering - Need: Security, scalability, DevOps efficiency  \n3. IT Service Company CEOs - Need: Multi-client infrastructure, capacity\n4. Infrastructure/Platform Specialists - Need: Performance, compliance, stability\n\nCRITICAL REQUIREMENTS:\n- Focus on BUSINESS OUTCOMES (revenue, security, capacity, speed)\n- Reference prospect's SPECIFIC role/company context\n- NO generic advice - be prospect-specific\n- Pitches must feel like you researched this person\n- Each pitch must be completely different, not variations\n- Quality > Templates\n\nOUTPUT: Strict JSON with prospect-level insights.`;\n\n    const userPrompt = `Generate fresh pitch suggestions for this prospect:\n\nName: ${prospect.name}\nRole: ${prospect.role}\nCompany: ${prospect.company}\n${prospect.location ? `Location: ${prospect.location}` : \"\"}\n${prospect.description ? `Description: ${prospect.description}` : \"\"}\n${prospect.profile ? `Profile: ${prospect.profile}` : \"\"}\n\nReturn ONLY valid JSON with this exact structure:\n{\n  \"name\": ${JSON.stringify(prospect.name)},\n  \"role\": ${JSON.stringify(prospect.role)},\n  \"company\": ${JSON.stringify(prospect.company)},${prospect.location ? `\\n  \"location\": ${JSON.stringify(prospect.location)},` : \"\"}${prospect.description ? `\\n  \"description\": ${JSON.stringify(prospect.description)},` : \"\"}\n  \"profileNotes\": \"2-3 sentences analyzing prospect's likely priorities based on role/company\",\n  \"pitchSuggestions\": [\n    { \"pitch\": \"First pitch approach focused on specific business outcome\" },\n    { \"pitch\": \"Second pitch approach from different angle\" },\n    { \"pitch\": \"Third pitch approach with unique value proposition\" }\n  ],\n  \"conversationStarter\": \"Personalized opening message showing understanding of their context\"\n}`;\n\n    for (let rateLimitRetry = 0; rateLimitRetry < MAX_RATE_LIMIT_RETRIES; rateLimitRetry++) {\n      try {\n        const rawJson = await geminiClient.callWithRetry({\n          model: \"gemini-2.5-flash\",\n          systemInstruction: systemPrompt,\n          userPrompt,\n          temperature: 0.8,\n          responseMimeType: \"application/json\",\n        });\n\n        const parsedResponse = JSON.parse(rawJson);\n        const validatedInsight = ProspectInsightSchema.parse(parsedResponse);\n\n        // Preserve optional fields from the request\n        const enrichedInsight = {\n          ...validatedInsight,\n          location: prospect.location,\n          description: prospect.description,\n        };\n\n        return NextResponse.json(enrichedInsight);\n      } catch (error) {\n        if (error instanceof RateLimitError && rateLimitRetry < MAX_RATE_LIMIT_RETRIES - 1) {\n          const waitTime = (error.retryAfter || 60) * 1000;\n          console.log(`[Regenerate Pitch] All keys on cooldown. Waiting ${error.retryAfter || 60}s before retry (attempt ${rateLimitRetry + 1}/${MAX_RATE_LIMIT_RETRIES})...`);\n          await sleep(waitTime);\n          continue;\n        }\n        \n        throw error;\n      }\n    }\n  } catch (error) {\n    console.error(\"Regenerate pitch error:\", error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: \"Invalid request data\", details: error.issues },\n        { status: 400 }\n      );\n    }\n\n    if (error instanceof RateLimitError) {\n      return NextResponse.json(\n        { \n          error: \"Rate limit exceeded. Please wait and try again.\",\n          retryAfter: error.retryAfter,\n        },\n        { status: 429 }\n      );\n    }\n\n    if (error instanceof CustomValidationError) {\n      return NextResponse.json(\n        { error: error.message },\n        { status: 400 }\n      );\n    }\n\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : \"Failed to regenerate pitch\" },\n      { status: 500 }\n    );\n  }\n}\n","size_bytes":5467},"DEPLOYMENT_GUIDE.md":{"content":"# Cehpoint Client Insight Engine - Deployment Guide\n\n## Production Deployment on Vercel\n\n### Prerequisites\n- Vercel account (free tier works)\n- 1-7 Google Gemini API keys (minimum 1, recommended 2-3 for reliability)\n- GitHub repository (or other Git provider)\n\n### Step 1: Prepare API Keys\n\n1. **Generate Gemini API Keys**\n   - Visit [Google AI Studio](https://ai.google.dev)\n   - Create 1-7 API keys (more keys = better reliability)\n   - Copy each key securely\n\n2. **Recommended Key Setup**\n   - **Minimum**: 1 key (GEMINI_API_KEY_PRIMARY)\n   - **Recommended**: 2-3 keys (PRIMARY + SECONDARY + EXTRA_1)\n   - **Maximum**: 7 keys (PRIMARY + SECONDARY + EXTRA_1-5)\n\n### Step 2: Deploy to Vercel\n\n#### Option A: Deploy via Vercel Dashboard\n\n1. **Import Project**\n   ```\n   1. Go to https://vercel.com/new\n   2. Import your Git repository\n   3. Select the repository\n   4. Click \"Import\"\n   ```\n\n2. **Configure Environment Variables**\n   ```\n   In the \"Environment Variables\" section, add:\n   \n   Required (Minimum):\n   - GEMINI_API_KEY_PRIMARY = your_first_api_key\n   \n   Recommended (For Reliability):\n   - GEMINI_API_KEY_SECONDARY = your_second_api_key\n   - GEMINI_API_KEY_EXTRA_1 = your_third_api_key\n   \n   Optional (Maximum Reliability):\n   - GEMINI_API_KEY_EXTRA_2 = your_fourth_api_key\n   - GEMINI_API_KEY_EXTRA_3 = your_fifth_api_key\n   - GEMINI_API_KEY_EXTRA_4 = your_sixth_api_key\n   - GEMINI_API_KEY_EXTRA_5 = your_seventh_api_key\n   ```\n\n3. **Deploy**\n   ```\n   Click \"Deploy\" and wait 2-3 minutes\n   ```\n\n#### Option B: Deploy via Vercel CLI\n\n1. **Install Vercel CLI**\n   ```bash\n   npm install -g vercel\n   ```\n\n2. **Login**\n   ```bash\n   vercel login\n   ```\n\n3. **Deploy**\n   ```bash\n   vercel --prod\n   ```\n\n4. **Set Environment Variables**\n   ```bash\n   vercel env add GEMINI_API_KEY_PRIMARY\n   vercel env add GEMINI_API_KEY_SECONDARY\n   vercel env add GEMINI_API_KEY_EXTRA_1\n   # Add more as needed\n   ```\n\n### Step 3: Verify Deployment\n\n1. **Test File Upload**\n   - Upload a small CSV/Excel file with 5-10 prospects\n   - Verify analysis completes successfully\n\n2. **Test Error Handling**\n   - Upload larger file (50+ prospects)\n   - Verify processing continues even with rate limits\n   - Check that batch processing completes\n\n3. **Test Features**\n   - âœ… Pitch regeneration works\n   - âœ… Pitch expansion works\n   - âœ… Export (Text/JSON) works\n   - âœ… Mid-process export works\n\n## Production Environment Variables\n\n### Required Variables\n\n| Variable | Description | Example |\n|----------|-------------|---------|\n| `GEMINI_API_KEY_PRIMARY` | Primary Gemini API key | `AIzaSy...` |\n\n### Optional Variables (Recommended)\n\n| Variable | Description | Fallback Behavior |\n|----------|-------------|-------------------|\n| `GEMINI_API_KEY_SECONDARY` | Secondary API key for failover | Uses PRIMARY only if not set |\n| `GEMINI_API_KEY_EXTRA_1` | Third API key | Uses PRIMARY + SECONDARY |\n| `GEMINI_API_KEY_EXTRA_2` | Fourth API key | Uses previous keys |\n| `GEMINI_API_KEY_EXTRA_3` | Fifth API key | Uses previous keys |\n| `GEMINI_API_KEY_EXTRA_4` | Sixth API key | Uses previous keys |\n| `GEMINI_API_KEY_EXTRA_5` | Seventh API key | Uses previous keys |\n\n### Backward Compatibility\n\nThe system also supports legacy environment variables:\n- `GEMINI_API_KEY` (treated as PRIMARY if PRIMARY not set)\n- `GEMINI_API_KEY_2` (treated as SECONDARY if SECONDARY not set)\n\n## Error Handling System\n\n### Production-Grade Features\n\n1. **Multi-Key Rotation**\n   - Automatic failover between API keys\n   - Per-key failure tracking and cooldown\n   - No single point of failure\n\n2. **Exponential Backoff Retry**\n   - 1s â†’ 2s â†’ 4s â†’ 8s â†’ 16s delays (max 60s)\n   - Maximum 5 retry attempts per request\n   - Jitter to prevent thundering herd\n\n3. **Error Classification**\n   - **RateLimitError**: API quota exceeded â†’ Wait and retry\n   - **AuthError**: Invalid API key â†’ Switch to next key\n   - **TransientAPIError**: Temporary failures â†’ Retry with backoff\n   - **FatalAPIError**: Non-retryable errors â†’ Stop immediately\n\n4. **Cooldown Management**\n   - Failed keys enter 60s cooldown (auth errors: 5min)\n   - Prevents cascading failures\n   - Automatic recovery when cooldown expires\n\n### Monitoring Logs\n\nThe application logs detailed telemetry for debugging:\n\n```\n[Gemini API] Analyzing 5 prospect(s)...\n[Gemini API] Retry attempt 2/5 after 2.0s (key: primary, error: Rate limit exceeded)\n[Gemini API] All keys on cooldown. Waiting 60s before retry (attempt 1/10)...\n[Gemini API] âœ“ Successfully generated insights for 5 prospect(s)\n```\n\n## Performance Optimization\n\n### Batch Processing\n- Files processed in batches of 5 prospects\n- Initial batch: 15 prospects immediately\n- Subsequent batches: 15 prospects every 60 seconds\n- Unlimited file size support\n\n### Vercel Limits\n- **Function Timeout**: 60s (Hobby) / 900s (Pro)\n- **Response Size**: 4.5MB max\n- **Memory**: 1024MB default\n- Streaming responses prevent timeout issues\n\n### Recommended Settings\n\nFor large files (500+ prospects), consider Vercel Pro:\n- Longer function timeout (15 min vs 60s)\n- Higher concurrent function limit\n- Priority support\n\n## Troubleshooting\n\n### Issue: Rate Limit Errors\n\n**Symptoms**: \"Rate limit exceeded\" errors during processing\n\n**Solution**:\n1. Add more API keys (SECONDARY, EXTRA_1, EXTRA_2)\n2. System will automatically rotate through keys\n3. Processing continues after cooldown period\n\n### Issue: Build Fails\n\n**Symptoms**: Deployment fails during build\n\n**Solution**:\n```bash\n# Check TypeScript errors locally\nnpm run build\n\n# Fix any reported errors\n# Re-deploy\nvercel --prod\n```\n\n### Issue: Missing Environment Variables\n\n**Symptoms**: \"No Gemini API keys configured\" error\n\n**Solution**:\n1. Go to Vercel dashboard â†’ Settings â†’ Environment Variables\n2. Add `GEMINI_API_KEY_PRIMARY` with your API key\n3. Redeploy: Deployments â†’ Latest â†’ Redeploy\n\n### Issue: Processing Stops Mid-File\n\n**Symptoms**: Large files stop processing after initial batch\n\n**Solution**:\n- Expected behavior: System waits 60s between batches\n- Check logs for rate limit messages\n- Add more API keys for faster processing\n- System will complete all prospects eventually\n\n## Security Best Practices\n\n### API Key Management\n1. âœ… Never commit API keys to Git\n2. âœ… Use Vercel environment variables\n3. âœ… Rotate keys regularly\n4. âœ… Monitor usage in Google AI Studio\n5. âœ… Set usage alerts in Google Cloud\n\n### Production Checklist\n- [ ] All API keys configured in Vercel\n- [ ] Test deployment with sample file\n- [ ] Verify error handling works\n- [ ] Check logs for issues\n- [ ] Enable error monitoring (Sentry/etc)\n- [ ] Set up uptime monitoring\n\n## Support & Maintenance\n\n### Updating the Application\n\n1. **Push to Git**\n   ```bash\n   git push origin main\n   ```\n\n2. **Auto-Deploy**\n   - Vercel automatically deploys on push\n   - Check deployment status in dashboard\n\n3. **Manual Redeploy**\n   ```bash\n   vercel --prod\n   ```\n\n### Monitoring\n\n1. **Vercel Analytics**\n   - View in dashboard â†’ Analytics\n   - Track page views, errors, performance\n\n2. **Function Logs**\n   - View in dashboard â†’ Functions â†’ Logs\n   - Search for errors or specific requests\n\n3. **API Usage**\n   - Monitor in Google AI Studio\n   - Track quota usage per key\n\n## Cost Estimation\n\n### Vercel\n- **Hobby Plan**: Free\n  - 100GB bandwidth/month\n  - 100 hours serverless function execution\n  - Perfect for small-medium usage\n\n- **Pro Plan**: $20/month\n  - 1TB bandwidth/month\n  - 1000 hours function execution\n  - Recommended for heavy usage\n\n### Google Gemini API\n- **Free Tier**: 15 requests/minute per key\n  - With 3 keys: ~45 requests/minute\n  - ~2700 prospects/hour theoretical max\n  - Sufficient for most use cases\n\n- **Paid Tier**: Unlimited (pay-per-request)\n  - ~$0.000125 per prospect (gemini-2.5-flash)\n  - 1000 prospects â‰ˆ $0.125\n  - 10,000 prospects â‰ˆ $1.25\n\n## Additional Resources\n\n- [Vercel Documentation](https://vercel.com/docs)\n- [Next.js Documentation](https://nextjs.org/docs)\n- [Google Gemini API](https://ai.google.dev/docs)\n- [Project GitHub Repository](your-repo-url)\n\n---\n\n**Last Updated**: November 2025\n**Version**: 5.2 (Production-Grade Error Handling)\n","size_bytes":8158},"lib/retry.ts":{"content":"export interface RetryConfig {\n  maxAttempts: number;\n  baseDelay: number;\n  maxDelay: number;\n  jitter: boolean;\n}\n\nexport const DEFAULT_RETRY_CONFIG: RetryConfig = {\n  maxAttempts: 5,\n  baseDelay: 1000,\n  maxDelay: 60000,\n  jitter: true,\n};\n\nexport function calculateBackoff(\n  attempt: number,\n  config: RetryConfig = DEFAULT_RETRY_CONFIG\n): number {\n  const exponentialDelay = Math.min(\n    config.baseDelay * Math.pow(2, attempt),\n    config.maxDelay\n  );\n\n  if (config.jitter) {\n    const jitterAmount = exponentialDelay * 0.2;\n    return exponentialDelay + (Math.random() * jitterAmount * 2 - jitterAmount);\n  }\n\n  return exponentialDelay;\n}\n\nexport async function sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nexport async function retryWithBackoff<T>(\n  fn: () => Promise<T>,\n  config: RetryConfig = DEFAULT_RETRY_CONFIG,\n  onRetry?: (attempt: number, error: Error, delay: number) => void\n): Promise<T> {\n  let lastError: Error;\n\n  for (let attempt = 0; attempt < config.maxAttempts; attempt++) {\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error instanceof Error ? error : new Error(String(error));\n\n      if (attempt < config.maxAttempts - 1) {\n        const delay = calculateBackoff(attempt, config);\n        onRetry?.(attempt + 1, lastError, delay);\n        await sleep(delay);\n      }\n    }\n  }\n\n  throw lastError!;\n}\n","size_bytes":1415},"app/api/expand-pitch/route.ts":{"content":"import { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\nimport { geminiClient } from \"@/lib/gemini-client\";\nimport { RateLimitError, ValidationError as CustomValidationError } from \"@/lib/errors\";\nimport { sleep } from \"@/lib/retry\";\n\nconst MAX_RATE_LIMIT_RETRIES = 10;\n\nconst ProspectContextSchema = z.object({\n  name: z.string(),\n  role: z.string(),\n  company: z.string(),\n  location: z.string().optional(),\n  description: z.string().optional(),\n});\n\nconst ExpandPitchRequestSchema = z.object({\n  prospect: ProspectContextSchema,\n  pitch: z.string(),\n});\n\nconst ExpandedPitchResponseSchema = z.object({\n  expandedPitch: z.string(),\n});\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const { prospect, pitch } = ExpandPitchRequestSchema.parse(body);\n\n    const systemPrompt = `You are an expert B2B sales copywriter specializing in crafting compelling, personalized outreach for Cehpoint's premium services.\n\nCEHPOINT - PREMIUM SERVICES FIRM:\nWe deliver enterprise-scale solutions:\n- Custom software development & architecture modernization\n- Security implementation: HIPAA, SOC2, PCI-DSS, ISO 27001 compliance\n- Infrastructure optimization: Cloud, DevSecOps, CI/CD automation\n- AI/ML integration & technical innovation\n- Overflow engineering capacity & dedicated technical teams\n- Security audits, architecture reviews, penetration testing\n\nWRITING GUIDELINES:\n- Professional, confident tone without being pushy\n- Focus on business outcomes and ROI\n- Address specific pain points based on prospect's role/company\n- Include concrete examples or scenarios when relevant\n- Keep it conversational yet professional\n- 2-3 well-structured paragraphs (200-250 words total)\n- End with a soft call-to-action or next step\n\nOUTPUT: Return ONLY valid JSON with the expanded pitch.`;\n\n    const userPrompt = `Expand this short pitch into a full, detailed outreach message:\n\nSHORT PITCH: ${pitch}\n\nPROSPECT CONTEXT:\nName: ${prospect.name}\nRole: ${prospect.role}\nCompany: ${prospect.company}\n${prospect.location ? `Location: ${prospect.location}` : \"\"}\n${prospect.description ? `Description: ${prospect.description}` : \"\"}\n\nCreate a compelling 2-3 paragraph pitch (200-250 words) that:\n1. Opens with understanding of their specific situation/challenges\n2. Explains how Cehpoint solves their problem with concrete benefits\n3. Ends with a natural next step or question\n\nReturn ONLY valid JSON with this exact structure:\n{\n  \"expandedPitch\": \"Full multi-paragraph pitch text here. Use \\\\n\\\\n to separate paragraphs.\"\n}`;\n\n    for (let rateLimitRetry = 0; rateLimitRetry < MAX_RATE_LIMIT_RETRIES; rateLimitRetry++) {\n      try {\n        const rawJson = await geminiClient.callWithRetry({\n          model: \"gemini-2.5-flash\",\n          systemInstruction: systemPrompt,\n          userPrompt,\n          temperature: 0.7,\n          responseMimeType: \"application/json\",\n        });\n\n        const parsedResponse = JSON.parse(rawJson);\n        const validatedResponse =\n          ExpandedPitchResponseSchema.parse(parsedResponse);\n\n        return NextResponse.json(validatedResponse);\n      } catch (error) {\n        if (error instanceof RateLimitError && rateLimitRetry < MAX_RATE_LIMIT_RETRIES - 1) {\n          const waitTime = (error.retryAfter || 60) * 1000;\n          console.log(`[Expand Pitch] All keys on cooldown. Waiting ${error.retryAfter || 60}s before retry (attempt ${rateLimitRetry + 1}/${MAX_RATE_LIMIT_RETRIES})...`);\n          await sleep(waitTime);\n          continue;\n        }\n        \n        throw error;\n      }\n    }\n  } catch (error) {\n    console.error(\"Expand pitch error:\", error);\n\n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: \"Invalid request data\", details: error.issues },\n        { status: 400 }\n      );\n    }\n\n    if (error instanceof RateLimitError) {\n      return NextResponse.json(\n        { \n          error: \"Rate limit exceeded. Please wait a moment and try again.\",\n          retryAfter: error.retryAfter,\n        },\n        { status: 429 }\n      );\n    }\n\n    if (error instanceof CustomValidationError) {\n      return NextResponse.json(\n        { error: error.message },\n        { status: 400 }\n      );\n    }\n\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : \"Failed to generate expanded pitch\" },\n      { status: 500 }\n    );\n  }\n}\n","size_bytes":4401},"lib/gemini-client.ts":{"content":"import { GoogleGenAI } from \"@google/genai\";\nimport {\n  RateLimitError,\n  AuthError,\n  TransientAPIError,\n  FatalAPIError,\n  isRetryableError,\n  shouldSwitchKey,\n  getRetryDelay,\n} from \"./errors\";\nimport { calculateBackoff, sleep, RetryConfig, DEFAULT_RETRY_CONFIG } from \"./retry\";\n\ninterface APIKey {\n  key: string;\n  name: string;\n  failureCount: number;\n  lastFailure?: number;\n  cooldownUntil?: number;\n}\n\ninterface GeminiCallOptions {\n  model: string;\n  systemInstruction: string;\n  userPrompt: string;\n  temperature?: number;\n  responseMimeType?: string;\n}\n\ninterface RetryTelemetry {\n  attempt: number;\n  maxAttempts: number;\n  error: Error;\n  delay: number;\n  keyUsed: string;\n}\n\nexport class GeminiClient {\n  private keys: APIKey[] = [];\n  private currentKeyIndex: number = 0;\n  private retryConfig: RetryConfig = DEFAULT_RETRY_CONFIG;\n\n  constructor(retryConfig?: Partial<RetryConfig>) {\n    this.loadAPIKeys();\n    if (retryConfig) {\n      this.retryConfig = { ...DEFAULT_RETRY_CONFIG, ...retryConfig };\n    }\n  }\n\n  private loadAPIKeys(): void {\n    const primaryKey = process.env.GEMINI_API_KEY_PRIMARY || process.env.GEMINI_API_KEY;\n    const secondaryKey = process.env.GEMINI_API_KEY_SECONDARY;\n\n    if (primaryKey) {\n      this.keys.push({\n        key: primaryKey,\n        name: \"primary\",\n        failureCount: 0,\n      });\n    }\n\n    if (secondaryKey) {\n      this.keys.push({\n        key: secondaryKey,\n        name: \"secondary\",\n        failureCount: 0,\n      });\n    }\n\n    for (let i = 1; i <= 5; i++) {\n      const extraKey = process.env[`GEMINI_API_KEY_EXTRA_${i}`];\n      if (extraKey) {\n        this.keys.push({\n          key: extraKey,\n          name: `extra_${i}`,\n          failureCount: 0,\n        });\n      }\n    }\n\n    if (this.keys.length === 0) {\n      throw new Error(\"No Gemini API keys configured\");\n    }\n  }\n\n  private getNextAvailableKey(): APIKey | null {\n    const now = Date.now();\n    const startIndex = this.currentKeyIndex;\n\n    for (let i = 0; i < this.keys.length; i++) {\n      const index = (startIndex + i) % this.keys.length;\n      const key = this.keys[index];\n\n      if (key.cooldownUntil && key.cooldownUntil > now) {\n        continue;\n      }\n\n      this.currentKeyIndex = index;\n      return key;\n    }\n\n    return null;\n  }\n\n  private markKeyFailed(key: APIKey, cooldownMs: number = 60000): void {\n    key.failureCount++;\n    key.lastFailure = Date.now();\n    key.cooldownUntil = Date.now() + cooldownMs;\n  }\n\n  private markKeySuccess(key: APIKey): void {\n    key.failureCount = 0;\n    key.cooldownUntil = undefined;\n  }\n\n  private classifyError(error: any): Error {\n    const errorMessage = error?.message || String(error);\n    const statusCode = error?.status || error?.statusCode;\n\n    if (statusCode === 429 || errorMessage.includes(\"rate limit\") || errorMessage.includes(\"quota\")) {\n      const retryAfter = error?.retryAfter || 60;\n      return new RateLimitError(errorMessage, retryAfter);\n    }\n\n    if (\n      statusCode === 401 ||\n      statusCode === 403 ||\n      errorMessage.includes(\"API key\") ||\n      errorMessage.includes(\"authentication\")\n    ) {\n      return new AuthError(errorMessage);\n    }\n\n    if (statusCode === 400 || errorMessage.includes(\"validation\")) {\n      return new FatalAPIError(errorMessage);\n    }\n\n    if (\n      statusCode === 500 ||\n      statusCode === 502 ||\n      statusCode === 503 ||\n      statusCode === 504 ||\n      errorMessage.includes(\"timeout\") ||\n      errorMessage.includes(\"network\")\n    ) {\n      return new TransientAPIError(errorMessage);\n    }\n\n    return new FatalAPIError(errorMessage);\n  }\n\n  async callWithRetry(\n    options: GeminiCallOptions,\n    onRetry?: (telemetry: RetryTelemetry) => void\n  ): Promise<string> {\n    let lastError: Error;\n\n    for (let attempt = 0; attempt < this.retryConfig.maxAttempts; attempt++) {\n      const key = this.getNextAvailableKey();\n\n      if (!key) {\n        const minCooldown = Math.min(\n          ...this.keys\n            .filter((k) => k.cooldownUntil)\n            .map((k) => (k.cooldownUntil! - Date.now()) / 1000)\n        );\n        throw new RateLimitError(\n          `All API keys are on cooldown. Minimum wait: ${minCooldown.toFixed(0)}s`,\n          Math.ceil(minCooldown)\n        );\n      }\n\n      try {\n        const ai = new GoogleGenAI({ apiKey: key.key });\n        const response = await ai.models.generateContent({\n          model: options.model,\n          config: {\n            systemInstruction: options.systemInstruction,\n            responseMimeType: options.responseMimeType || \"application/json\",\n            temperature: options.temperature ?? 0.7,\n          },\n          contents: [{ role: \"user\", parts: [{ text: options.userPrompt }] }],\n        });\n\n        let rawJson: string | null = null;\n\n        if ((response as any)?.text) {\n          rawJson = (response as any).text;\n        } else if ((response as any)?.response?.text) {\n          rawJson = (response as any).response.text;\n        } else if ((response as any)?.candidates?.[0]?.content?.parts?.[0]?.text) {\n          rawJson = (response as any).candidates[0].content.parts[0].text;\n        }\n\n        if (!rawJson) {\n          throw new Error(\"Failed to extract response from Gemini API\");\n        }\n\n        this.markKeySuccess(key);\n        return rawJson.trim();\n      } catch (error) {\n        const classifiedError = this.classifyError(error);\n        lastError = classifiedError;\n\n        if (shouldSwitchKey(classifiedError)) {\n          this.markKeyFailed(key, 300000);\n          continue;\n        }\n\n        if (!isRetryableError(classifiedError)) {\n          throw classifiedError;\n        }\n\n        if (attempt < this.retryConfig.maxAttempts - 1) {\n          const customDelay = getRetryDelay(classifiedError);\n          const delay = customDelay !== undefined\n            ? customDelay\n            : calculateBackoff(attempt, this.retryConfig);\n\n          if (classifiedError instanceof RateLimitError) {\n            this.markKeyFailed(key, delay);\n          }\n\n          onRetry?.({\n            attempt: attempt + 1,\n            maxAttempts: this.retryConfig.maxAttempts,\n            error: classifiedError,\n            delay,\n            keyUsed: key.name,\n          });\n\n          await sleep(delay);\n        }\n      }\n    }\n\n    throw lastError!;\n  }\n}\n\nexport const geminiClient = new GeminiClient();\n","size_bytes":6367},"app/components/ExpandPitchModal.tsx":{"content":"\"use client\";\n\nimport { useEffect, useState, useCallback } from \"react\";\nimport { ProspectInsight } from \"@/lib/types\";\n\ninterface ExpandPitchModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  prospect: ProspectInsight;\n  shortPitch: string;\n}\n\nexport default function ExpandPitchModal({\n  isOpen,\n  onClose,\n  prospect,\n  shortPitch,\n}: ExpandPitchModalProps) {\n  const [expandedPitch, setExpandedPitch] = useState<string>(\"\");\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [copied, setCopied] = useState(false);\n\n  const generateExpandedPitch = useCallback(async () => {\n    setIsGenerating(true);\n    setError(null);\n\n    try {\n      const response = await fetch(\"/api/expand-pitch\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          prospect: {\n            name: prospect.name,\n            role: prospect.role,\n            company: prospect.company,\n            location: prospect.location,\n            description: prospect.description,\n          },\n          pitch: shortPitch,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to generate full pitch\");\n      }\n\n      const data = await response.json();\n      setExpandedPitch(data.expandedPitch);\n    } catch (err) {\n      setError(\n        err instanceof Error ? err.message : \"Failed to generate full pitch\"\n      );\n    } finally {\n      setIsGenerating(false);\n    }\n  }, [prospect, shortPitch]);\n\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = \"hidden\";\n      generateExpandedPitch();\n\n      const handleEscape = (e: KeyboardEvent) => {\n        if (e.key === \"Escape\") {\n          onClose();\n        }\n      };\n\n      document.addEventListener(\"keydown\", handleEscape);\n\n      return () => {\n        document.body.style.overflow = \"unset\";\n        document.removeEventListener(\"keydown\", handleEscape);\n      };\n    } else {\n      document.body.style.overflow = \"unset\";\n      setExpandedPitch(\"\");\n      setError(null);\n      setCopied(false);\n    }\n  }, [isOpen, onClose, generateExpandedPitch, prospect, shortPitch]);\n\n  const handleCopy = async () => {\n    if (expandedPitch) {\n      await navigator.clipboard.writeText(expandedPitch);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    }\n  };\n\n  const handleRetry = () => {\n    generateExpandedPitch();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      <div\n        className=\"absolute inset-0 bg-black/40 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n\n      <div className=\"relative w-full max-w-3xl bg-white rounded-2xl shadow-2xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <div className=\"p-6 border-b border-gray-200\">\n          <div className=\"flex items-start justify-between\">\n            <div className=\"flex-1\">\n              <h2 className=\"text-2xl font-semibold text-gray-900\">\n                Full Pitch\n              </h2>\n              <p className=\"mt-1 text-sm text-gray-600\">\n                {prospect.name} â€¢ {prospect.role} at {prospect.company}\n              </p>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n            >\n              <svg\n                className=\"w-6 h-6\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                stroke=\"currentColor\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M6 18L18 6M6 6l12 12\"\n                />\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          <div className=\"mb-6\">\n            <h3 className=\"text-sm font-medium text-gray-700 mb-2\">\n              Original Pitch\n            </h3>\n            <div className=\"p-4 bg-blue-50 border border-blue-100 rounded-lg\">\n              <p className=\"text-gray-800\">{shortPitch}</p>\n            </div>\n          </div>\n\n          <div>\n            <h3 className=\"text-sm font-medium text-gray-700 mb-2\">\n              Expanded Pitch\n            </h3>\n\n            {isGenerating && (\n              <div className=\"space-y-3\">\n                <div className=\"h-4 bg-gray-200 rounded animate-pulse\" />\n                <div className=\"h-4 bg-gray-200 rounded animate-pulse w-5/6\" />\n                <div className=\"h-4 bg-gray-200 rounded animate-pulse w-4/6\" />\n                <div className=\"h-4 bg-gray-200 rounded animate-pulse\" />\n                <div className=\"h-4 bg-gray-200 rounded animate-pulse w-3/4\" />\n              </div>\n            )}\n\n            {error && (\n              <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg\">\n                <p className=\"text-red-800 mb-3\">{error}</p>\n                <button\n                  onClick={handleRetry}\n                  className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium\"\n                >\n                  Retry\n                </button>\n              </div>\n            )}\n\n            {!isGenerating && !error && expandedPitch && (\n              <div className=\"p-6 bg-gray-50 border border-gray-200 rounded-lg\">\n                <div className=\"prose prose-sm max-w-none\">\n                  {expandedPitch.split(\"\\n\\n\").map((paragraph, index) => (\n                    <p key={index} className=\"text-gray-800 mb-4 last:mb-0 leading-relaxed\">\n                      {paragraph}\n                    </p>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"p-6 border-t border-gray-200 bg-gray-50 flex items-center justify-end gap-3\">\n          {expandedPitch && !isGenerating && !error && (\n            <button\n              onClick={handleCopy}\n              className=\"px-5 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center gap-2\"\n            >\n              {copied ? (\n                <>\n                  <svg\n                    className=\"w-4 h-4\"\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    stroke=\"currentColor\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 13l4 4L19 7\"\n                    />\n                  </svg>\n                  Copied!\n                </>\n              ) : (\n                <>\n                  <svg\n                    className=\"w-4 h-4\"\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    stroke=\"currentColor\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"\n                    />\n                  </svg>\n                  Copy Pitch\n                </>\n              )}\n            </button>\n          )}\n          <button\n            onClick={onClose}\n            className=\"px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium\"\n          >\n            Close\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7751},"app/components/RegeneratePitchModal.tsx":{"content":"\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { ProspectInsight } from \"@/lib/types\";\n\ninterface RegeneratePitchModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  prospect: ProspectInsight;\n  onRegenerate: (updatedProspect: ProspectInsight) => void;\n}\n\nexport default function RegeneratePitchModal({\n  isOpen,\n  onClose,\n  prospect,\n  onRegenerate,\n}: RegeneratePitchModalProps) {\n  const [isRegenerating, setIsRegenerating] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Close on Escape key\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") onClose();\n    };\n    if (isOpen) {\n      document.addEventListener(\"keydown\", handleEscape);\n      document.body.style.overflow = \"hidden\";\n    }\n    return () => {\n      document.removeEventListener(\"keydown\", handleEscape);\n      document.body.style.overflow = \"unset\";\n    };\n  }, [isOpen, onClose]);\n\n  const handleRegenerate = async () => {\n    setIsRegenerating(true);\n    setError(null);\n\n    try {\n      const response = await fetch(\"/api/regenerate-pitch\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(prospect),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to regenerate pitches\");\n      }\n\n      const updatedProspect: ProspectInsight = await response.json();\n      onRegenerate(updatedProspect);\n      onClose();\n    } catch (err) {\n      console.error(\"Regeneration error:\", err);\n      setError(\"Failed to regenerate pitches. Please try again.\");\n    } finally {\n      setIsRegenerating(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <>\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n        <div\n          className=\"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* Header */}\n          <div className=\"px-6 py-4 border-b border-gray-200\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">\n                Regenerate Pitch Suggestions\n              </h3>\n              <button\n                onClick={onClose}\n                className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n          </div>\n\n          {/* Content */}\n          <div className=\"px-6 py-5 overflow-y-auto max-h-[calc(90vh-180px)]\">\n            <div className=\"space-y-4\">\n              {/* Prospect Info */}\n              <div className=\"p-4 bg-gray-50 border border-gray-200 rounded-lg\">\n                <h4 className=\"font-semibold text-gray-900 mb-1\">{prospect.name}</h4>\n                <p className=\"text-sm text-gray-600\">{prospect.role}</p>\n                <p className=\"text-sm text-gray-500\">{prospect.company}</p>\n              </div>\n\n              {/* Current Pitches */}\n              <div>\n                <h4 className=\"text-sm font-semibold text-gray-900 mb-3\">\n                  Current Pitch Suggestions\n                </h4>\n                <div className=\"space-y-2\">\n                  {prospect.pitchSuggestions.map((pitch, idx) => (\n                    <div\n                      key={idx}\n                      className=\"p-3 bg-gray-50 border border-gray-200 rounded-lg\"\n                    >\n                      <div className=\"flex gap-2\">\n                        <span className=\"text-sm font-medium text-gray-500 flex-shrink-0\">\n                          {idx + 1}.\n                        </span>\n                        <p className=\"text-sm text-gray-700\">{pitch.pitch}</p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Info Message */}\n              <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n                <div className=\"flex gap-2\">\n                  <svg className=\"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                  </svg>\n                  <p className=\"text-sm text-blue-800\">\n                    This will generate 3 completely new pitch variations for {prospect.name}. The current pitches will be replaced with fresh ideas.\n                  </p>\n                </div>\n              </div>\n\n              {/* Error Message */}\n              {error && (\n                <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n                  <p className=\"text-sm text-red-700\">{error}</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Footer */}\n          <div className=\"px-6 py-4 border-t border-gray-200 bg-gray-50\">\n            <div className=\"flex items-center justify-end gap-3\">\n              <button\n                onClick={onClose}\n                disabled={isRegenerating}\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleRegenerate}\n                disabled={isRegenerating}\n                className=\"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2\"\n              >\n                {isRegenerating ? (\n                  <>\n                    <svg className=\"animate-spin h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\">\n                      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                    </svg>\n                    Generating...\n                  </>\n                ) : (\n                  <>\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                    </svg>\n                    Generate New Pitches\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n","size_bytes":7261},"lib/errors.ts":{"content":"export class RateLimitError extends Error {\n  constructor(\n    message: string = \"API rate limit exceeded\",\n    public retryAfter?: number\n  ) {\n    super(message);\n    this.name = \"RateLimitError\";\n  }\n}\n\nexport class AuthError extends Error {\n  constructor(message: string = \"API authentication failed\") {\n    super(message);\n    this.name = \"AuthError\";\n  }\n}\n\nexport class ValidationError extends Error {\n  constructor(message: string = \"Validation failed\") {\n    super(message);\n    this.name = \"ValidationError\";\n  }\n}\n\nexport class TransientAPIError extends Error {\n  constructor(message: string = \"Temporary API error\") {\n    super(message);\n    this.name = \"TransientAPIError\";\n  }\n}\n\nexport class FatalAPIError extends Error {\n  constructor(message: string = \"Fatal API error\") {\n    super(message);\n    this.name = \"FatalAPIError\";\n  }\n}\n\nexport function isRetryableError(error: unknown): boolean {\n  if (error instanceof RateLimitError) return true;\n  if (error instanceof TransientAPIError) return true;\n  if (error instanceof AuthError) return true;\n  return false;\n}\n\nexport function shouldSwitchKey(error: unknown): boolean {\n  return error instanceof AuthError;\n}\n\nexport function getRetryDelay(error: unknown): number | undefined {\n  if (error instanceof RateLimitError && error.retryAfter) {\n    return error.retryAfter * 1000;\n  }\n  return undefined;\n}\n","size_bytes":1373}},"version":2}